<!DOCTYPE html>
<html lang="zh-CN">
<head>
<!-- 2021-05-06 Thu 15:26 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>主播自定义活动</title>
<meta name="generator" content="Org mode">
<meta name="author" content="时中贺">
<link rel="stylesheet" type="text/css" href="file:/Users/he/notes/html/css/style.css" />
<link rel="shortcut icon" href="file:/Users/he/notes/html/images/favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="preamble" class="status">
<div id="navbar">
    <ul>
        <li id="site-master"><a href="file:/Users/he/notes/html/index.html">浪的不轻</a></li>
        <li><a class="navbar-item" href="file:/Users/he/notes/html/gallery.html">Gallery</a> </li>
        <li><a class="navbar-item" href="file:/Users/he/notes/html/notebooks.html">Notebooks</a> </li>
        <li><a class="navbar-item" href="file:/Users/he/notes/html/links.html">Links</a> </li>
        <li><a class="navbar-item" href="file:/Users/he/notes/html/about.html">About</a> </li>
        <li class="search">
            <form action="http://google.com/search" method="get" accept-charset="utf-8">
                <input type="search" id="search" name="q" autocomplete="off" maxlength="30" placeholder="Google..">
                <input type="hidden" name="q" value="site:www.langdebuqing.com">
            </form>
        </li>
    </ul>
</div>
</div>
<div id="content">
<h1 class="title">主播自定义活动</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org20b9b23">1. 缩略词 ec event-customized 活动定制</a></li>
<li><a href="#org1162504">2. 问题</a>
<ul>
<li><a href="#org5fde97f">2.1. 活动审核时已过了活动开始时间。自动设置未通过运营审核</a></li>
<li><a href="#org34c986e">2.2. 主题：其它。主题如何设计</a></li>
<li><a href="#org5174d48">2.3. ec_id 唯一确定一个活动</a></li>
<li><a href="#org2ee40b8">2.4. 浮动icon如果设计</a></li>
<li><a href="#org8669f07">2.5. 活动主题说明是添加一个HTTP API，还是直接在 ec_custom_event HTTP GET 接口中带过去？</a></li>
<li><a href="#orgc194245">2.6. 禁止用户得奖：跳过该用户发奖，不会把他从现有榜单删除，但不会再为他加分了</a></li>
<li><a href="#org44e49fc">2.7. 一个用户可活动多个奖励。表结构如何设计，用户邮寄地址放在哪里？获奖名单如何返回</a></li>
<li><a href="#org6d55171">2.8. 上传自制活动时，如何保存活动奖励：活动奖励暂存到 ec_user_custom_events，运营通过审核后转移到表 ec_rewards</a></li>
<li><a href="#orgc9035a5">2.9. 直播间弹窗有 2 个窗口，一是榜单信息，二是活动详情</a></li>
</ul>
</li>
<li><a href="#org45afbc3">3. 骑士榜单 1day</a></li>
<li><a href="#org68d3743">4. 加分模块 2day</a></li>
<li><a href="#org7fee2b4">5. 进房模块 1day</a></li>
<li><a href="#org9fc6e31">6. 结算模块 2day</a></li>
<li><a href="#org32ab8a3">7. 黑名单模块</a></li>
<li><a href="#orgb1c034c">8. 浮动icon增加自制活动</a></li>
<li><a href="#org6b9482d">9. 接口文档 + 概要设计 3day</a></li>
<li><a href="#orgb73f062">10. buffer 3day</a></li>
<li><a href="#org37022ee">11. 为王珏内容创建与分发提供各种函数接口</a></li>
<li><a href="#org4925f26">12. 私信通用card 发消息</a></li>
<li><a href="#org995744a">13. 接口 12day</a>
<ul>
<li><a href="#orgffbf8a1">13.1. 1.获取自己的活动 ec_my_events HTTP GET  2day</a>
<ul>
<li><a href="#org0736b4e">13.1.1. 请求参数</a></li>
<li><a href="#orgb53ede8">13.1.2. 返回参数</a></li>
</ul>
</li>
<li><a href="#org6c50b7f">13.2. 2.操作自己的活动 ec_my_events HTTP POST  1day</a>
<ul>
<li><a href="#org61d69f2">13.2.1. 请求参数</a></li>
</ul>
</li>
<li><a href="#org356956d">13.3. 3.获取关注主播的自定义活动 ec_followed_events HTTP GET 2day</a>
<ul>
<li><a href="#orgb4b665f">13.3.1. 请求参数</a></li>
<li><a href="#org991a574">13.3.2. 返回的活动元数据</a></li>
<li><a href="#org26040ab">13.3.3. 仅展示进行中、即将开始的活动</a></li>
<li><a href="#org1548550">13.3.4. 按 start_time 升序，按 ctime 升序</a></li>
<li><a href="#org0be1723">13.3.5. 暂时不做分页</a></li>
</ul>
</li>
<li><a href="#org5ede875">13.4. 4.获取所有主播的自定义活动 ec_total_events HTTP GET 1day</a>
<ul>
<li><a href="#orge57873b">13.4.1. 请求参数</a></li>
<li><a href="#org066b60d">13.4.2. 基于接口2，新增返回参数</a></li>
</ul>
</li>
<li><a href="#org61014b7">13.5. 5.获取自定义信息 ec_custom_event HTTP GET 1day</a>
<ul>
<li><a href="#org76f3c5c">13.5.1. 请求参数</a></li>
<li><a href="#org6e8ced5">13.5.2. 返回数据</a></li>
</ul>
</li>
<li><a href="#orga77d110">13.6. 6.定制活动 ec_custom_event HTTP POST 1day</a>
<ul>
<li><a href="#org6c617c5">13.6.1. 请求参数</a></li>
<li><a href="#org69a4474">13.6.2. 返回数据</a></li>
</ul>
</li>
<li><a href="#org7aeafb6">13.7. 7.查看活动获奖详情 ec_event_result HTTP GET 1day</a>
<ul>
<li><a href="#org1eac96f">13.7.1. 请求参数</a></li>
<li><a href="#orgcf68021">13.7.2. 返回数据</a></li>
</ul>
</li>
<li><a href="#org11ed38e">13.8. 8.收货地址接口 event_address GET  1day</a></li>
<li><a href="#orge4a274c">13.9. 9.收货地址接口 event_address POST</a></li>
<li><a href="#org065362e">13.10. 10.发现页预告：定制活动列表</a></li>
<li><a href="#orgbc1c31d">13.11. 11.直播间弹窗接口 ec_event_status HTTP GET 1day</a>
<ul>
<li><a href="#orgdbdcf17">13.11.1. 请求参数</a></li>
<li><a href="#orgd3885e0">13.11.2. 返回数据</a></li>
<li><a href="#orgaad39d4">13.11.3. 需求中直播间弹窗的第4个图片如何触发？</a></li>
</ul>
</li>
<li><a href="#org9e74fa1">13.12. 12.校验主播定制的时间范围 ec_check_event_time HTTP GET 1day</a>
<ul>
<li><a href="#orgcfc9c6c">13.12.1. 请求参数</a></li>
</ul>
</li>
<li><a href="#org2d614cf">13.13. 13.活动详情页 ec_event_info</a>
<ul>
<li><a href="#orga63b4db">13.13.1. 请求参数</a></li>
<li><a href="#org1c44cb9">13.13.2. 返回参数</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org21e0558">14. 运营后台 2day</a>
<ul>
<li><a href="#orgb44d134">14.1. 运营审核后台</a>
<ul>
<li><a href="#orge3f88ea">14.1.1. 关于审核后台的活动奖励怎么做？</a></li>
<li><a href="#orgb097d65">14.1.2. 审核完后发私信</a></li>
<li><a href="#org5b7ddf4">14.1.3. 审核完后，首次打开app后弹窗，如何实现？</a></li>
<li><a href="#orgec831fd">14.1.4. 审核后要保存活动奖励到 ec_rewards</a></li>
</ul>
</li>
<li><a href="#org12c9d39">14.2. 拉黑后台</a></li>
<li><a href="#org453b09b">14.3. 获奖名单后台</a></li>
<li><a href="#org65dc330">14.4. 用户地址后台</a></li>
<li><a href="#orge68e8ef">14.5. 主题后台</a></li>
</ul>
</li>
<li><a href="#org7340bc6">15. 赛前通知：活动开始前有用户进房通知</a></li>
<li><a href="#org1d04556">16. 赛后群聊通知主播</a></li>
<li><a href="#org982bc46">17. 赛后系统代主播给用户发获奖消息</a></li>
<li><a href="#org7077cfc">18. 发现页预告</a></li>
<li><a href="#org7e7746d">19. 数据结构</a>
<ul>
<li><a href="#orgc2a0dbf">19.1. table ec_themes</a></li>
<li><a href="#org5dc0fb9">19.2. table ec_events</a></li>
<li><a href="#org23295c8">19.3. table ec_awards</a></li>
<li><a href="#orge52f38c">19.4. table event_address</a></li>
<li><a href="#org7c98ed5">19.5. table event_black_list</a></li>
</ul>
</li>
<li><a href="#orgf7642ce">20. api</a>
<ul>
<li>
<ul>
<li><a href="#org9c6a73e">20.0.1. 中奖情况</a>
<ul>
<li><a href="#orgb82261d">20.0.1.1. 计算粉丝的抽奖礼物中奖情况  def ec_cal_lottery_award_info(uid, ec_id)</a></li>
<li><a href="#org35c6481">20.0.1.2. 计算粉丝排行榜礼物中奖情况  def ec_cal_rank_award_info(uid, ec_id)</a></li>
</ul>
</li>
<li><a href="#org1810ccd">20.0.2. 活动</a>
<ul>
<li><a href="#orgf826d2c">20.0.2.1. 获取我的活动接口 def ec_get_my_events(uid, refresh=False)</a></li>
<li><a href="#orgeac3e54">20.0.2.2. 获取当前全量活动接口 def ec_get_total_events(refresh=False)</a></li>
<li><a href="#org85b862e">20.0.2.3. 获取活动信息 def ec_get_event_info(ec_id, refresh=False)</a></li>
</ul>
</li>
<li><a href="#org88ad81c">20.0.3. 黑名单</a>
<ul>
<li><a href="#orgab2d21f">20.0.3.1. 批量获取是否被禁止创建自制活动接口  def get_event_block_uids(type, uid_list)</a></li>
</ul>
</li>
<li><a href="#org223cacc">20.0.4. 主题</a>
<ul>
<li><a href="#orgdf27a29">20.0.4.1. 获取所有系统主题 def ec_get_total_system_theme(refresh=False)</a></li>
<li><a href="#org1188d10">20.0.4.2. 获取指定系统主题 def ec_get_theme_info(theme_name, refresh=False)</a></li>
</ul>
</li>
<li><a href="#orgd7dbea9">20.0.5. 获奖名单</a>
<ul>
<li><a href="#org97ede28">20.0.5.1. 获取获奖名单 def ec_get_award_list(ec_id, refresh=False)</a></li>
<li><a href="#org085080e">20.0.5.2. 计算获奖名单 def ec_cal_award_list(ec_id)</a></li>
</ul>
</li>
<li><a href="#org867ed5a">20.0.6. 地址</a>
<ul>
<li><a href="#org4180e59">20.0.6.1. 获取用户地址 def get_event_address_by_uid(event_name, uid)</a></li>
</ul>
</li>
<li><a href="#org498b37e">20.0.7. 榜单</a>
<ul>
<li><a href="#orge2deb48">20.0.7.1. 根据 ec_id 获取榜单 def ec_get_rank_by_ec_id(ec_id)</a></li>
<li><a href="#org0fc141f">20.0.7.2. 获取粉丝得分、排名、距离上一名相差多少分 def ec_get_knight_rank_info(ec_id, uid)</a></li>
<li><a href="#orge4b86c1">20.0.7.3. 获取粉丝得分 def ec_get_knight_score(ec_id, uid)</a></li>
<li><a href="#orgf073e48">20.0.7.4. 获取粉丝排名 def ec_get_knight_rank(ec_id, uid)</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org587d467">21. 测试</a></li>
<li><a href="#org0d953bf">22. 优化</a>
<ul>
<li><a href="#org760f5bf">22.1. EventInfoView  db_ec_get_ec_awards_by_id 加缓存</a></li>
<li><a href="#orga13ffd7">22.2. 结算加锁</a></li>
<li><a href="#org76f42cc">22.3. 结算。获取活动详情走缓存</a></li>
<li><a href="#org7a2fa69">22.4. 结算。jump_url 改为 线上环境</a></li>
<li><a href="#org5ecc9b8">22.5. 结算。获取关注用户</a></li>
<li><a href="#orgd53a1c6">22.6. 结算。获取家族用户</a></li>
<li><a href="#orgdf9caf9">22.7. 结算。url 改为 线上环境</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org20b9b23" class="outline-2">
<h2 id="org20b9b23"><span class="section-number-2">1</span> 缩略词 ec event-customized 活动定制</h2>
</div>
<div id="outline-container-org1162504" class="outline-2">
<h2 id="org1162504"><span class="section-number-2">2</span> 问题</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org5fde97f" class="outline-3">
<h3 id="org5fde97f"><span class="section-number-3">2.1</span> 活动审核时已过了活动开始时间。自动设置未通过运营审核</h3>
</div>
<div id="outline-container-org34c986e" class="outline-3">
<h3 id="org34c986e"><span class="section-number-3">2.2</span> 主题：其它。主题如何设计</h3>
</div>
<div id="outline-container-org5174d48" class="outline-3">
<h3 id="org5174d48"><span class="section-number-3">2.3</span> ec_id 唯一确定一个活动</h3>
</div>
<div id="outline-container-org2ee40b8" class="outline-3">
<h3 id="org2ee40b8"><span class="section-number-3">2.4</span> 浮动icon如果设计</h3>
</div>
<div id="outline-container-org8669f07" class="outline-3">
<h3 id="org8669f07"><span class="section-number-3">2.5</span> 活动主题说明是添加一个HTTP API，还是直接在 ec_custom_event HTTP GET 接口中带过去？</h3>
</div>
<div id="outline-container-orgc194245" class="outline-3">
<h3 id="orgc194245"><span class="section-number-3">2.6</span> 禁止用户得奖：跳过该用户发奖，不会把他从现有榜单删除，但不会再为他加分了</h3>
</div>

<div id="outline-container-org44e49fc" class="outline-3">
<h3 id="org44e49fc"><span class="section-number-3">2.7</span> 一个用户可活动多个奖励。表结构如何设计，用户邮寄地址放在哪里？获奖名单如何返回</h3>
</div>
<div id="outline-container-org6d55171" class="outline-3">
<h3 id="org6d55171"><span class="section-number-3">2.8</span> 上传自制活动时，如何保存活动奖励：活动奖励暂存到 ec_user_custom_events，运营通过审核后转移到表 ec_rewards</h3>
</div>
<div id="outline-container-orgc9035a5" class="outline-3">
<h3 id="orgc9035a5"><span class="section-number-3">2.9</span> 直播间弹窗有 2 个窗口，一是榜单信息，二是活动详情</h3>
</div>
</div>
<div id="outline-container-org45afbc3" class="outline-2">
<h2 id="org45afbc3"><span class="section-number-2">3</span> 骑士榜单 1day</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li>加分<br></li>
<li>查分<br></li>
</ul>
</div>
</div>
<div id="outline-container-org68d3743" class="outline-2">
<h2 id="org68d3743"><span class="section-number-2">4</span> 加分模块 2day</h2>
</div>
<div id="outline-container-org7fee2b4" class="outline-2">
<h2 id="org7fee2b4"><span class="section-number-2">5</span> 进房模块 1day</h2>
</div>
<div id="outline-container-org9fc6e31" class="outline-2">
<h2 id="org9fc6e31"><span class="section-number-2">6</span> 结算模块 2day</h2>
</div>
<div id="outline-container-org32ab8a3" class="outline-2">
<h2 id="org32ab8a3"><span class="section-number-2">7</span> 黑名单模块</h2>
</div>
<div id="outline-container-orgb1c034c" class="outline-2">
<h2 id="orgb1c034c"><span class="section-number-2">8</span> 浮动icon增加自制活动</h2>
</div>
<div id="outline-container-org6b9482d" class="outline-2">
<h2 id="org6b9482d"><span class="section-number-2">9</span> 接口文档 + 概要设计 3day</h2>
</div>
<div id="outline-container-orgb73f062" class="outline-2">
<h2 id="orgb73f062"><span class="section-number-2">10</span> buffer 3day</h2>
</div>
<div id="outline-container-org37022ee" class="outline-2">
<h2 id="org37022ee"><span class="section-number-2">11</span> 为王珏内容创建与分发提供各种函数接口</h2>
<div class="outline-text-2" id="text-11">
<ul class="org-ul">
<li>自制活动预告列表<br></li>
<li>最新的自制活动<br></li>
<li>活动后，产生一个活动结束事件<br></li>
<li>让王珏提供一个函数：审核通过后，发通知<br></li>
</ul>
</div>
</div>
<div id="outline-container-org4925f26" class="outline-2">
<h2 id="org4925f26"><span class="section-number-2">12</span> 私信通用card 发消息</h2>
</div>
<div id="outline-container-org995744a" class="outline-2">
<h2 id="org995744a"><span class="section-number-2">13</span> 接口 12day</h2>
<div class="outline-text-2" id="text-13">
</div>
<div id="outline-container-orgffbf8a1" class="outline-3">
<h3 id="orgffbf8a1"><span class="section-number-3">13.1</span> 1.获取自己的活动 ec_my_events HTTP GET  2day</h3>
<div class="outline-text-3" id="text-13-1">
</div>
<div id="outline-container-org0736b4e" class="outline-4">
<h4 id="org0736b4e"><span class="section-number-4">13.1.1</span> 请求参数</h4>
<div class="outline-text-4" id="text-13-1-1">
<ul class="org-ul">
<li>session<br></li>
</ul>
</div>
</div>
<div id="outline-container-orgb53ede8" class="outline-4">
<h4 id="orgb53ede8"><span class="section-number-4">13.1.2</span> 返回参数</h4>
<div class="outline-text-4" id="text-13-1-2">
<ul class="org-ul">
<li>活动元数据<br>
<ul class="org-ul">
<li>ec_id<br></li>
<li>theme_name<br></li>
<li>start_time、end_time<br></li>
<li>活动奖励信息。<br></li>
<li>审核状态：1.审核中 2.未通过 3.已通过未发布 4.被删除 5.已通过未开始 6.已通过正在进行 7.已通过已结束<br></li>
<li>notice，对应审核状态<br>
<ol class="org-ol">
<li>运营审核中，请稍等<br></li>
<li>未通过原因：奖励过于色情<br></li>
<li>您的活动已经审核完成，点击发布即可通知用户<br></li>
<li>空<br></li>
<li>您的活动已经通知给用户了，不要忘记哦！<br></li>
</ol></li>
</ul></li>
<li>是否被运营拉黑<br></li>
<li>未发布的活动列表<br></li>
<li>已发布的活动列表<br></li>
<li>排序规则：1.按照 start_time 升序 2.按照 ctime 升序<br></li>
<li>展示规则<br>
<ol class="org-ol">
<li>活动已经开始还未审核，自动设置未通过运营审核<br></li>
<li>已结束的活动不展示<br></li>
</ol></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org6c50b7f" class="outline-3">
<h3 id="org6c50b7f"><span class="section-number-3">13.2</span> 2.操作自己的活动 ec_my_events HTTP POST  1day</h3>
<div class="outline-text-3" id="text-13-2">
</div>
<div id="outline-container-org61d69f2" class="outline-4">
<h4 id="org61d69f2"><span class="section-number-4">13.2.1</span> 请求参数</h4>
<div class="outline-text-4" id="text-13-2-1">
<ul class="org-ul">
<li>session<br></li>
<li>oper_type: 1-发布 2-删除<br></li>
<li>ec_id<br></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org356956d" class="outline-3">
<h3 id="org356956d"><span class="section-number-3">13.3</span> 3.获取关注主播的自定义活动 ec_followed_events HTTP GET 2day</h3>
<div class="outline-text-3" id="text-13-3">
</div>
<div id="outline-container-orgb4b665f" class="outline-4">
<h4 id="orgb4b665f"><span class="section-number-4">13.3.1</span> 请求参数</h4>
<div class="outline-text-4" id="text-13-3-1">
<ul class="org-ul">
<li>session<br></li>
</ul>
</div>
</div>
<div id="outline-container-org991a574" class="outline-4">
<h4 id="org991a574"><span class="section-number-4">13.3.2</span> 返回的活动元数据</h4>
<div class="outline-text-4" id="text-13-3-2">
<ul class="org-ul">
<li>ec_id<br></li>
<li>anchor_info<br></li>
<li>anchor_show<br></li>
<li>theme_name<br></li>
<li>start_time、end_time<br></li>
<li>event_status: 进行中、即将开始。<br></li>
<li>活动奖励列表<br></li>
</ul>
</div>
</div>
<div id="outline-container-org26040ab" class="outline-4">
<h4 id="org26040ab"><span class="section-number-4">13.3.3</span> 仅展示进行中、即将开始的活动</h4>
</div>
<div id="outline-container-org1548550" class="outline-4">
<h4 id="org1548550"><span class="section-number-4">13.3.4</span> 按 start_time 升序，按 ctime 升序</h4>
</div>
<div id="outline-container-org0be1723" class="outline-4">
<h4 id="org0be1723"><span class="section-number-4">13.3.5</span> 暂时不做分页</h4>
</div>
</div>

<div id="outline-container-org5ede875" class="outline-3">
<h3 id="org5ede875"><span class="section-number-3">13.4</span> 4.获取所有主播的自定义活动 ec_total_events HTTP GET 1day</h3>
<div class="outline-text-3" id="text-13-4">
</div>
<div id="outline-container-orge57873b" class="outline-4">
<h4 id="orge57873b"><span class="section-number-4">13.4.1</span> 请求参数</h4>
<div class="outline-text-4" id="text-13-4-1">
<ul class="org-ul">
<li>session<br></li>
</ul>
</div>
</div>
<div id="outline-container-org066b60d" class="outline-4">
<h4 id="org066b60d"><span class="section-number-4">13.4.2</span> 基于接口2，新增返回参数</h4>
<div class="outline-text-4" id="text-13-4-2">
<ul class="org-ul">
<li>is_followed<br></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org61014b7" class="outline-3">
<h3 id="org61014b7"><span class="section-number-3">13.5</span> 5.获取自定义信息 ec_custom_event HTTP GET 1day</h3>
<div class="outline-text-3" id="text-13-5">
</div>
<div id="outline-container-org76f3c5c" class="outline-4">
<h4 id="org76f3c5c"><span class="section-number-4">13.5.1</span> 请求参数</h4>
<div class="outline-text-4" id="text-13-5-1">
<p>
session<br>
</p>
</div>
</div>
<div id="outline-container-org6e8ced5" class="outline-4">
<h4 id="org6e8ced5"><span class="section-number-4">13.5.2</span> 返回数据</h4>
<div class="outline-text-4" id="text-13-5-2">
<ul class="org-ul">
<li>theme_info list    theme_info 中包含 help 信息<br></li>
<li>是否被运营拉黑<br></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-orga77d110" class="outline-3">
<h3 id="orga77d110"><span class="section-number-3">13.6</span> 6.定制活动 ec_custom_event HTTP POST 1day</h3>
<div class="outline-text-3" id="text-13-6">
</div>
<div id="outline-container-org6c617c5" class="outline-4">
<h4 id="org6c617c5"><span class="section-number-4">13.6.1</span> 请求参数</h4>
<div class="outline-text-4" id="text-13-6-1">
<ul class="org-ul">
<li>ec_id 非必须参数。无该参数-新建，有该参数-编辑<br></li>
<li>system_theme_name<br></li>
<li>customed_theme_name<br></li>
<li>desc<br></li>
<li>rewards json<br>
<ul class="org-ul">
<li>列表<br></li>
<li>元数据<br>
<ol class="org-ol">
<li>抽奖。name、photo、ec_type、count、must_follow、must_family、min_gold<br></li>
<li>排行榜。name、photo、ec_type、start_rank、end_rank、must_follow、must_family、min_gold<br></li>
</ol></li>
</ul></li>
<li>start_time end_time<br></li>
</ul>
</div>
</div>
<div id="outline-container-org69a4474" class="outline-4">
<h4 id="org69a4474"><span class="section-number-4">13.6.2</span> 返回数据</h4>
</div>
</div>

<div id="outline-container-org7aeafb6" class="outline-3">
<h3 id="org7aeafb6"><span class="section-number-3">13.7</span> 7.查看活动获奖详情 ec_event_result HTTP GET 1day</h3>
<div class="outline-text-3" id="text-13-7">
</div>
<div id="outline-container-org1eac96f" class="outline-4">
<h4 id="org1eac96f"><span class="section-number-4">13.7.1</span> 请求参数</h4>
<div class="outline-text-4" id="text-13-7-1">
<ul class="org-ul">
<li>ec_id<br></li>
</ul>
</div>
</div>
<div id="outline-container-orgcf68021" class="outline-4">
<h4 id="orgcf68021"><span class="section-number-4">13.7.2</span> 返回数据</h4>
<div class="outline-text-4" id="text-13-7-2">
<ul class="org-ul">
<li>活动信息：start_time end_time theme_name, rewards<br></li>
<li>获奖用户列表  是否分页？<br></li>
<li>主播信息<br></li>
<li>问号帮助信息。这个返回什么？<br></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org11ed38e" class="outline-3">
<h3 id="org11ed38e"><span class="section-number-3">13.8</span> 8.收货地址接口 event_address GET  1day</h3>
</div>
<div id="outline-container-orge4a274c" class="outline-3">
<h3 id="orge4a274c"><span class="section-number-3">13.9</span> 9.收货地址接口 event_address POST</h3>
</div>
<div id="outline-container-org065362e" class="outline-3">
<h3 id="org065362e"><span class="section-number-3">13.10</span> 10.发现页预告：定制活动列表</h3>
</div>
<div id="outline-container-orgbc1c31d" class="outline-3">
<h3 id="orgbc1c31d"><span class="section-number-3">13.11</span> 11.直播间弹窗接口 ec_event_status HTTP GET 1day</h3>
<div class="outline-text-3" id="text-13-11">
</div>
<div id="outline-container-orgdbdcf17" class="outline-4">
<h4 id="orgdbdcf17"><span class="section-number-4">13.11.1</span> 请求参数</h4>
<div class="outline-text-4" id="text-13-11-1">
<ul class="org-ul">
<li>ec_id<br></li>
</ul>
</div>
</div>
<div id="outline-container-orgd3885e0" class="outline-4">
<h4 id="orgd3885e0"><span class="section-number-4">13.11.2</span> 返回数据</h4>
<div class="outline-text-4" id="text-13-11-2">
<ul class="org-ul">
<li>活动信息：start_time end_time theme_name, rewards<br></li>
<li>骑士榜单  是否分页？<br></li>
<li>问号帮助信息。这个返回什么？<br></li>
</ul>
</div>
</div>
<div id="outline-container-orgaad39d4" class="outline-4">
<h4 id="orgaad39d4"><span class="section-number-4">13.11.3</span> 需求中直播间弹窗的第4个图片如何触发？</h4>
</div>
</div>

<div id="outline-container-org9e74fa1" class="outline-3">
<h3 id="org9e74fa1"><span class="section-number-3">13.12</span> 12.校验主播定制的时间范围 ec_check_event_time HTTP GET 1day</h3>
<div class="outline-text-3" id="text-13-12">
</div>
<div id="outline-container-orgcfc9c6c" class="outline-4">
<h4 id="orgcfc9c6c"><span class="section-number-4">13.12.1</span> 请求参数</h4>
<div class="outline-text-4" id="text-13-12-1">
<ul class="org-ul">
<li>session<br></li>
<li>start_time end_time<br></li>
<li>system_theme_name<br></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org2d614cf" class="outline-3">
<h3 id="org2d614cf"><span class="section-number-3">13.13</span> 13.活动详情页 ec_event_info</h3>
<div class="outline-text-3" id="text-13-13">
</div>
<div id="outline-container-orga63b4db" class="outline-4">
<h4 id="orga63b4db"><span class="section-number-4">13.13.1</span> 请求参数</h4>
<div class="outline-text-4" id="text-13-13-1">
<ul class="org-ul">
<li>ec_id<br></li>
</ul>
</div>
</div>

<div id="outline-container-org1c44cb9" class="outline-4">
<h4 id="org1c44cb9"><span class="section-number-4">13.13.2</span> 返回参数</h4>
<div class="outline-text-4" id="text-13-13-2">
<ul class="org-ul">
<li>奖励信息：奖品名、数量、照片、发奖类型等<br></li>
<li>theme_name<br></li>
<li>start_time end_time<br></li>
<li>活动礼物信息<br></li>
<li>desc<br></li>
</ul>
</div>
</div>
</div>
</div>
<div id="outline-container-org21e0558" class="outline-2">
<h2 id="org21e0558"><span class="section-number-2">14</span> 运营后台 2day</h2>
<div class="outline-text-2" id="text-14">
</div>
<div id="outline-container-orgb44d134" class="outline-3">
<h3 id="orgb44d134"><span class="section-number-3">14.1</span> 运营审核后台</h3>
<div class="outline-text-3" id="text-14-1">
</div>
<div id="outline-container-orge3f88ea" class="outline-4">
<h4 id="orge3f88ea"><span class="section-number-4">14.1.1</span> 关于审核后台的活动奖励怎么做？</h4>
</div>
<div id="outline-container-orgb097d65" class="outline-4">
<h4 id="orgb097d65"><span class="section-number-4">14.1.2</span> 审核完后发私信</h4>
<div class="outline-text-4" id="text-14-1-2">
<ul class="org-ul">
<li>审核结果<br></li>
<li>主题<br></li>
<li>start_time end_time<br></li>
<li>rewards<br></li>
<li><b><b>跳转到活动详情，如何跳转？</b></b><br></li>
</ul>
</div>
</div>
<div id="outline-container-org5b7ddf4" class="outline-4">
<h4 id="org5b7ddf4"><span class="section-number-4">14.1.3</span> 审核完后，首次打开app后弹窗，如何实现？</h4>
</div>
<div id="outline-container-orgec831fd" class="outline-4">
<h4 id="orgec831fd"><span class="section-number-4">14.1.4</span> 审核后要保存活动奖励到 ec_rewards</h4>
</div>
</div>
<div id="outline-container-org12c9d39" class="outline-3">
<h3 id="org12c9d39"><span class="section-number-3">14.2</span> 拉黑后台</h3>
</div>
<div id="outline-container-org453b09b" class="outline-3">
<h3 id="org453b09b"><span class="section-number-3">14.3</span> 获奖名单后台</h3>
</div>
<div id="outline-container-org65dc330" class="outline-3">
<h3 id="org65dc330"><span class="section-number-3">14.4</span> 用户地址后台</h3>
</div>
<div id="outline-container-orge68e8ef" class="outline-3">
<h3 id="orge68e8ef"><span class="section-number-3">14.5</span> 主题后台</h3>
</div>
</div>
<div id="outline-container-org7340bc6" class="outline-2">
<h2 id="org7340bc6"><span class="section-number-2">15</span> 赛前通知：活动开始前有用户进房通知</h2>
<div class="outline-text-2" id="text-15">
<ul class="org-ul">
<li>赛前是什么时间？如果有多个活动即将开始呢？<br></li>
</ul>
</div>
</div>
<div id="outline-container-org1d04556" class="outline-2">
<h2 id="org1d04556"><span class="section-number-2">16</span> 赛后群聊通知主播</h2>
</div>
<div id="outline-container-org982bc46" class="outline-2">
<h2 id="org982bc46"><span class="section-number-2">17</span> 赛后系统代主播给用户发获奖消息</h2>
<div class="outline-text-2" id="text-17">
<ul class="org-ul">
<li>奖励名称、数量<br></li>
<li>主播信息<br></li>
</ul>
</div>
</div>

<div id="outline-container-org7077cfc" class="outline-2">
<h2 id="org7077cfc"><span class="section-number-2">18</span> 发现页预告</h2>
</div>
<div id="outline-container-org7e7746d" class="outline-2">
<h2 id="org7e7746d"><span class="section-number-2">19</span> 数据结构</h2>
<div class="outline-text-2" id="text-19">
</div>
<div id="outline-container-orgc2a0dbf" class="outline-3">
<h3 id="orgc2a0dbf"><span class="section-number-3">19.1</span> table ec_themes</h3>
<div class="outline-text-3" id="text-19-1">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #5f8700;">CREATE</span> <span style="color: #5f8700;">TABLE</span> `ec_themes` (
`id` <span style="color: #af8700;">int</span>(10) unsigned <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> AUTO_INCREMENT,
`<span style="color: #5f8700;">type</span>` tinyint(4) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'0'</span> COMMENT <span style="color: #00afaf;">'1-system 2-customed'</span>,
`theme_name` <span style="color: #af8700;">varchar</span>(64) <span style="color: #af8700;">CHARACTER</span> <span style="color: #5f8700;">SET</span> utf8mb4 <span style="color: #5f8700;">COLLATE</span> utf8mb4_bin <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">''</span>,
`theme_style` tinyint(4) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'0'</span> COMMENT <span style="color: #00afaf;">'&#20027;&#39064;&#39118;&#26684;&#12290;1-&#29983;&#26085;&#39118;&#26684; 2-&#31881;&#19997;&#31361;&#30772; 3-&#32426;&#24565;&#26085; 4-&#26376;&#24213;&#24863;&#35874; 5-&#20854;&#20182;'</span>,
`<span style="color: #5f8700;">position</span>` <span style="color: #af8700;">int</span>(10) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'1000'</span> COMMENT <span style="color: #00afaf;">'&#35813;&#20027;&#39064;&#20301;&#32622;&#65292;&#29992;&#26469;&#25490;&#24207;&#30340;'</span>,
`gifts_setting` <span style="color: #af8700;">varchar</span>(512) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">''</span> COMMENT <span style="color: #00afaf;">'&#35813;&#20027;&#39064;&#31867;&#22411;&#30340;&#27963;&#21160;&#30340;&#25910;&#31036;&#37197;&#32622;&#12290;json &#20018;'</span>,
`info` <span style="color: #af8700;">varchar</span>(8192) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'{}'</span> COMMENT <span style="color: #00afaf;">'&#20027;&#39064;&#24110;&#21161;&#20449;&#24687; json &#20018;'</span>,
`icon` <span style="color: #af8700;">varchar</span>(1024) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">''</span> COMMENT <span style="color: #00afaf;">'&#28014;&#21160; icon &#22270;&#29255; url'</span>,
`use_cnt` <span style="color: #af8700;">int</span>(10) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'0'</span> COMMENT <span style="color: #00afaf;">'&#20351;&#29992;&#27425;&#25968;'</span>,
`is_enabled` tinyint(4) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'1'</span>,
`ctime` datetime <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span>,
`mtime` <span style="color: #af8700;">timestamp</span> <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #5f8700;">CURRENT_TIMESTAMP</span> <span style="color: #5f8700;">ON</span> <span style="color: #5f8700;">UPDATE</span> <span style="color: #5f8700;">CURRENT_TIMESTAMP</span>,
<span style="color: #5f8700;">PRIMARY</span> <span style="color: #5f8700;">KEY</span> (`id`),
<span style="color: #5f8700;">UNIQUE</span> <span style="color: #5f8700;">KEY</span> `uniq_theme_name` (`theme_name`)
) ENGINE = InnoDB AUTO_INCREMENT = 1 <span style="color: #5f8700;">DEFAULT</span> CHARSET = utf8mb4 COMMENT=<span style="color: #00afaf;">'&#20027;&#39064;&#34920;'</span>;
</pre>
</div>
</div>
</div>
<div id="outline-container-org5dc0fb9" class="outline-3">
<h3 id="org5dc0fb9"><span class="section-number-3">19.2</span> table ec_events</h3>
<div class="outline-text-3" id="text-19-2">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #5f8700;">CREATE</span> <span style="color: #5f8700;">TABLE</span> `ec_events` (
`id` <span style="color: #af8700;">int</span>(10) unsigned <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> AUTO_INCREMENT COMMENT <span style="color: #00afaf;">'&#20195;&#30721;&#20013;&#29992;&#26469;&#21807;&#19968;&#26631;&#35782;&#19968;&#20010;&#27963;&#21160;'</span>,
`uid` <span style="color: #af8700;">varchar</span>(32) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span>,
`theme_name` <span style="color: #af8700;">varchar</span>(64) <span style="color: #af8700;">CHARACTER</span> <span style="color: #5f8700;">SET</span> utf8mb4 <span style="color: #5f8700;">COLLATE</span> utf8mb4_bin <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">''</span>,
`theme_style` tinyint(4) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'0'</span> COMMENT <span style="color: #00afaf;">'&#20027;&#39064;&#31867;&#22411;&#12290;1-&#29983;&#26085;&#39118;&#26684; 2-&#31881;&#19997;&#31361;&#30772; 3-&#32426;&#24565;&#26085; 4-&#26376;&#24213;&#24863;&#35874; 5-&#20854;&#20182;'</span>,
`gifts_setting` <span style="color: #af8700;">varchar</span>(512) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">''</span> COMMENT <span style="color: #00afaf;">'&#35813;&#27963;&#21160;&#25910;&#31036;&#37197;&#32622;&#12290;json &#20018;'</span>,
`rewards` <span style="color: #af8700;">varchar</span>(8192) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'[]'</span> COMMENT <span style="color: #00afaf;">'&#27963;&#21160;&#22870;&#21169;&#12290;json&#20018;'</span>,
`audit` tinyint(4) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'0'</span> COMMENT <span style="color: #00afaf;">'&#36816;&#33829;&#23457;&#26680;&#32467;&#26524;&#12290;1-&#24453;&#23457;&#26680; 2-&#26410;&#36807;&#23457;&#26680; 3-&#23457;&#26680;&#36890;&#36807; 4-&#34987;&#21024;&#38500; 5-&#24050;&#21457;&#24067; 8-&#24050;&#32467;&#31639;'</span>,
`notice` <span style="color: #af8700;">varchar</span>(128) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">''</span> COMMENT <span style="color: #00afaf;">'&#23457;&#26680;&#26410;&#36890;&#36807;&#21407;&#22240;&#12289;&#21457;&#24067;&#21518;&#25552;&#31034;&#20449;&#24687;&#65292;&#29992;&#20110;&#36820;&#22238;&#32473;&#21069;&#31471;'</span>,
`<span style="color: #5f8700;">desc</span>` <span style="color: #af8700;">varchar</span>(4096) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">''</span> COMMENT <span style="color: #00afaf;">'&#27963;&#21160;&#25551;&#36848;&#20449;&#24687;'</span>,
`start_time` datetime <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> COMMENT <span style="color: #00afaf;">'&#27963;&#21160;&#24320;&#22987;&#26102;&#38388; UTC'</span>,
`end_time` datetime <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> COMMENT <span style="color: #00afaf;">'&#27963;&#21160;&#32467;&#26463;&#26102;&#38388; UTC'</span>,
`is_enabled` tinyint(4) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'1'</span>,
`ctime` datetime <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span>,
`mtime` <span style="color: #af8700;">timestamp</span> <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #5f8700;">CURRENT_TIMESTAMP</span> <span style="color: #5f8700;">ON</span> <span style="color: #5f8700;">UPDATE</span> <span style="color: #5f8700;">CURRENT_TIMESTAMP</span>,
<span style="color: #5f8700;">PRIMARY</span> <span style="color: #5f8700;">KEY</span> (`id`),
<span style="color: #5f8700;">KEY</span> `idx_uid_theme_name` (`uid`, `theme_name`),
<span style="color: #5f8700;">KEY</span> `idx_end_time` (`end_time`)
) ENGINE = InnoDB AUTO_INCREMENT = 1 <span style="color: #5f8700;">DEFAULT</span> CHARSET = utf8mb4 COMMENT=<span style="color: #00afaf;">'&#33258;&#21046;&#27963;&#21160;&#34920;'</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org23295c8" class="outline-3">
<h3 id="org23295c8"><span class="section-number-3">19.3</span> table ec_awards</h3>
<div class="outline-text-3" id="text-19-3">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #5f8700;">CREATE</span> <span style="color: #5f8700;">TABLE</span> `ec_awards` (
`id` <span style="color: #af8700;">int</span>(10) unsigned <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> AUTO_INCREMENT,
`ec_id` <span style="color: #af8700;">int</span>(10) unsigned <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> COMMENT <span style="color: #00afaf;">'&#33258;&#21046;&#27963;&#21160;ID'</span>,
`uid` <span style="color: #af8700;">varchar</span>(32) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span>,
`index` <span style="color: #af8700;">int</span>(10) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> COMMENT <span style="color: #00afaf;">'&#22870;&#21697;&#32034;&#24341;'</span>,
`<span style="color: #5f8700;">name</span>` <span style="color: #af8700;">varchar</span>(64) <span style="color: #af8700;">CHARACTER</span> <span style="color: #5f8700;">SET</span> utf8mb4 <span style="color: #5f8700;">COLLATE</span> utf8mb4_bin <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">''</span> COMMENT <span style="color: #00afaf;">'&#22870;&#21697;&#21517;'</span>,
`photo` <span style="color: #af8700;">varchar</span>(1024) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">''</span> COMMENT <span style="color: #00afaf;">'&#22870;&#21697;&#29031;&#29255;'</span>,
`<span style="color: #5f8700;">count</span>` <span style="color: #af8700;">int</span>(10) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'0'</span> COMMENT <span style="color: #00afaf;">'&#33719;&#22870;&#25968;&#37327;'</span>,
`reason` <span style="color: #af8700;">varchar</span>(128) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">''</span> COMMENT <span style="color: #00afaf;">'&#33719;&#22870;&#29702;&#30001;'</span>,
`is_enabled` tinyint(4) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'1'</span>,
`ctime` datetime <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span>,
`mtime` <span style="color: #af8700;">timestamp</span> <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #5f8700;">CURRENT_TIMESTAMP</span> <span style="color: #5f8700;">ON</span> <span style="color: #5f8700;">UPDATE</span> <span style="color: #5f8700;">CURRENT_TIMESTAMP</span>,
<span style="color: #5f8700;">PRIMARY</span> <span style="color: #5f8700;">KEY</span> (`id`),
<span style="color: #5f8700;">KEY</span> `idx_ec_id` (`ec_id`)
) ENGINE = InnoDB AUTO_INCREMENT = 1 <span style="color: #5f8700;">DEFAULT</span> CHARSET = utf8mb4 COMMENT=<span style="color: #00afaf;">'&#33719;&#22870;&#29992;&#25143;&#34920;'</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-orge52f38c" class="outline-3">
<h3 id="orge52f38c"><span class="section-number-3">19.4</span> table event_address</h3>
<div class="outline-text-3" id="text-19-4">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #5f8700;">CREATE</span> <span style="color: #5f8700;">TABLE</span> `event_address` (
`id` <span style="color: #af8700;">int</span>(10) unsigned <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> AUTO_INCREMENT,
`uid` <span style="color: #af8700;">varchar</span>(32) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span>,
`event_name` <span style="color: #af8700;">varchar</span>(64) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> COMMENT <span style="color: #00afaf;">'&#33258;&#21046;&#27963;&#21160;&#35813;&#23383;&#27573;&#20026; "ec_" + ec_id'</span>,
`address` <span style="color: #af8700;">varchar</span>(1024) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">''</span>,
`postcode` <span style="color: #af8700;">varchar</span>(32) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">''</span> COMMENT <span style="color: #00afaf;">'&#37038;&#32534;'</span>,
`tel` <span style="color: #af8700;">varchar</span>(32) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">''</span>,
`<span style="color: #5f8700;">name</span>` <span style="color: #af8700;">varchar</span>(64) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">''</span>,
`notes` <span style="color: #af8700;">varchar</span>(1024) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">''</span> COMMENT <span style="color: #00afaf;">'&#22791;&#27880;'</span>,
`ctime` datetime <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span>,
`mtime` <span style="color: #af8700;">timestamp</span> <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #5f8700;">CURRENT_TIMESTAMP</span> <span style="color: #5f8700;">ON</span> <span style="color: #5f8700;">UPDATE</span> <span style="color: #5f8700;">CURRENT_TIMESTAMP</span>,
<span style="color: #5f8700;">PRIMARY</span> <span style="color: #5f8700;">KEY</span> (`id`),
<span style="color: #5f8700;">UNIQUE</span> <span style="color: #5f8700;">KEY</span> `uniq_event_name_uid` (`event_name`, `uid`)
) ENGINE = InnoDB AUTO_INCREMENT = 1 <span style="color: #5f8700;">DEFAULT</span> CHARSET = utf8mb4 COMMENT=<span style="color: #00afaf;">'&#27963;&#21160;&#37038;&#23492;&#22320;&#22336;&#34920;'</span>;
</pre>
</div>
</div>
</div>

<div id="outline-container-org7c98ed5" class="outline-3">
<h3 id="org7c98ed5"><span class="section-number-3">19.5</span> table event_black_list</h3>
<div class="outline-text-3" id="text-19-5">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #5f8700;">CREATE</span> <span style="color: #5f8700;">TABLE</span> `event_black_list` (
`id` <span style="color: #af8700;">int</span>(10) unsigned <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> AUTO_INCREMENT,
`oper_role` <span style="color: #af8700;">varchar</span>(32) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'system'</span> COMMENT <span style="color: #00afaf;">'&#25805;&#20316;&#20154;&#21592;&#12290;system-&#36816;&#33829;&#25163;&#21160;&#25289;&#40657; uid-&#20027;&#25773;&#25289;&#40657;'</span>,
`uid` <span style="color: #af8700;">varchar</span>(32) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span>,
`<span style="color: #5f8700;">type</span>` tinyint(4) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'0'</span> COMMENT <span style="color: #00afaf;">'1-&#31105;&#27490;&#33258;&#21046;&#27963;&#21160; 2-&#31105;&#27490;&#22312;&#33258;&#21046;&#27963;&#21160;&#33719;&#22870;'</span>,
`reason` <span style="color: #af8700;">varchar</span>(1024) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">''</span> COMMENT <span style="color: #00afaf;">'&#31105;&#27490;&#29702;&#30001;'</span>,
`start_time` datetime <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> COMMENT <span style="color: #00afaf;">'&#24320;&#22987;&#26102;&#38388; UTC'</span>,
`end_time` datetime <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> COMMENT <span style="color: #00afaf;">'&#32467;&#26463;&#26102;&#38388; UTC'</span>,
`is_enabled` tinyint(4) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'1'</span>,
`ctime` datetime <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span>,
`mtime` <span style="color: #af8700;">timestamp</span> <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #5f8700;">CURRENT_TIMESTAMP</span> <span style="color: #5f8700;">ON</span> <span style="color: #5f8700;">UPDATE</span> <span style="color: #5f8700;">CURRENT_TIMESTAMP</span>,
<span style="color: #5f8700;">PRIMARY</span> <span style="color: #5f8700;">KEY</span> (`id`),
<span style="color: #5f8700;">UNIQUE</span> <span style="color: #5f8700;">KEY</span> `uniq_oper_role_type_uid` (`oper_role`, `<span style="color: #5f8700;">type</span>`, `uid`)
) ENGINE = InnoDB AUTO_INCREMENT = 1 <span style="color: #5f8700;">DEFAULT</span> CHARSET = utf8mb4 COMMENT=<span style="color: #00afaf;">'&#27963;&#21160;&#40657;&#21517;&#21333;&#34920;'</span>;
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf7642ce" class="outline-2">
<h2 id="orgf7642ce"><span class="section-number-2">20</span> api</h2>
<div class="outline-text-2" id="text-20">
</div>
<div id="outline-container-org9c6a73e" class="outline-4">
<h4 id="org9c6a73e"><span class="section-number-4">20.0.1</span> 中奖情况</h4>
<div class="outline-text-4" id="text-20-0-1">
</div>
<div id="outline-container-orgb82261d" class="outline-5">
<h5 id="orgb82261d"><span class="section-number-5">20.0.1.1</span> 计算粉丝的抽奖礼物中奖情况  def ec_cal_lottery_award_info(uid, ec_id)</h5>
</div>
<div id="outline-container-org35c6481" class="outline-5">
<h5 id="org35c6481"><span class="section-number-5">20.0.1.2</span> 计算粉丝排行榜礼物中奖情况  def ec_cal_rank_award_info(uid, ec_id)</h5>
</div>
</div>
<div id="outline-container-org1810ccd" class="outline-4">
<h4 id="org1810ccd"><span class="section-number-4">20.0.2</span> 活动</h4>
<div class="outline-text-4" id="text-20-0-2">
</div>
<div id="outline-container-orgf826d2c" class="outline-5">
<h5 id="orgf826d2c"><span class="section-number-5">20.0.2.1</span> 获取我的活动接口 def ec_get_my_events(uid, refresh=False)</h5>
<div class="outline-text-5" id="text-20-0-2-1">
<ul class="org-ul">
<li>EC_MY_EVENTS_FORMAT<br></li>
<li>该key中保存的数据可能有1.审核中 2.未通过 3.已通过未发布 5.已通过正在进行 6.已通过未开始<br></li>
<li>缓存刷新的几种情况<br>
<ul class="org-ul">
<li>创建/修改自制活动<br></li>
<li>审核通过/未通过<br></li>
<li>删除自制活动<br></li>
<li>发布自制活动<br></li>
</ul></li>
<li>不刷新的情况<br>
<ul class="org-ul">
<li>我的活动接口发现活动未开始、正在进行、已结束这3种状态变化时，不刷新缓存<br></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-orgeac3e54" class="outline-5">
<h5 id="orgeac3e54"><span class="section-number-5">20.0.2.2</span> 获取当前全量活动接口 def ec_get_total_events(refresh=False)</h5>
<div class="outline-text-5" id="text-20-0-2-2">
<ul class="org-ul">
<li>EC_TOTAL_EVENTS<br></li>
<li>缓存刷新的几种情况。暂时采用主动刷新<br>
<ul class="org-ul">
<li>发布新活动时<br></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org85b862e" class="outline-5">
<h5 id="org85b862e"><span class="section-number-5">20.0.2.3</span> 获取活动信息 def ec_get_event_info(ec_id, refresh=False)</h5>
<div class="outline-text-5" id="text-20-0-2-3">
<ul class="org-ul">
<li>EC_EVENT_INFO_FORMAT<br></li>
<li>刷新缓存的几种情况。<br>
<ul class="org-ul">
<li>创建/修改自制活动<br></li>
<li>审核通过/未通过<br></li>
<li>删除自制活动<br></li>
<li>发布自制活动<br></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org88ad81c" class="outline-4">
<h4 id="org88ad81c"><span class="section-number-4">20.0.3</span> 黑名单</h4>
<div class="outline-text-4" id="text-20-0-3">
</div>
<div id="outline-container-orgab2d21f" class="outline-5">
<h5 id="orgab2d21f"><span class="section-number-5">20.0.3.1</span> 批量获取是否被禁止创建自制活动接口  def get_event_block_uids(type, uid_list)</h5>
<div class="outline-text-5" id="text-20-0-3-1">
<ul class="org-ul">
<li>EVENT_BLOCK_FORMAT<br></li>
</ul>
</div>
</div>
</div>

<div id="outline-container-org223cacc" class="outline-4">
<h4 id="org223cacc"><span class="section-number-4">20.0.4</span> 主题</h4>
<div class="outline-text-4" id="text-20-0-4">
</div>
<div id="outline-container-orgdf27a29" class="outline-5">
<h5 id="orgdf27a29"><span class="section-number-5">20.0.4.1</span> 获取所有系统主题 def ec_get_total_system_theme(refresh=False)</h5>
<div class="outline-text-5" id="text-20-0-4-1">
<ul class="org-ul">
<li>EC_TOTAL_SYSTEM_THEMES<br></li>
<li>缓存刷新的几种情况<br>
<ul class="org-ul">
<li>运营增删改主题<br></li>
</ul></li>
</ul>
</div>
</div>
<div id="outline-container-org1188d10" class="outline-5">
<h5 id="org1188d10"><span class="section-number-5">20.0.4.2</span> 获取指定系统主题 def ec_get_theme_info(theme_name, refresh=False)</h5>
<div class="outline-text-5" id="text-20-0-4-2">
<ul class="org-ul">
<li>EC_SYSTEM_THEME_INFO_FORMAT<br></li>
<li>缓存刷新的几种情况<br>
<ul class="org-ul">
<li>运营增删改该主题<br></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-orgd7dbea9" class="outline-4">
<h4 id="orgd7dbea9"><span class="section-number-4">20.0.5</span> 获奖名单</h4>
<div class="outline-text-4" id="text-20-0-5">
</div>
<div id="outline-container-org97ede28" class="outline-5">
<h5 id="org97ede28"><span class="section-number-5">20.0.5.1</span> 获取获奖名单 def ec_get_award_list(ec_id, refresh=False)</h5>
<div class="outline-text-5" id="text-20-0-5-1">
<ul class="org-ul">
<li>EC_AWARD_LIST_FORMAT<br></li>
<li>缓存基本不用刷新<br></li>
</ul>
</div>
</div>
<div id="outline-container-org085080e" class="outline-5">
<h5 id="org085080e"><span class="section-number-5">20.0.5.2</span> 计算获奖名单 def ec_cal_award_list(ec_id)</h5>
<div class="outline-text-5" id="text-20-0-5-2">
<ul class="org-ul">
<li>一个用户可获得多个奖品。奖品是在这里 merge 吗?<br></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org867ed5a" class="outline-4">
<h4 id="org867ed5a"><span class="section-number-4">20.0.6</span> 地址</h4>
<div class="outline-text-4" id="text-20-0-6">
</div>
<div id="outline-container-org4180e59" class="outline-5">
<h5 id="org4180e59"><span class="section-number-5">20.0.6.1</span> 获取用户地址 def get_event_address_by_uid(event_name, uid)</h5>
<div class="outline-text-5" id="text-20-0-6-1">
<ul class="org-ul">
<li>EVENT_ADDRESS_FORMAT<br></li>
<li>刷新缓存的几种情况<br>
<ul class="org-ul">
<li>编辑/修改地址<br></li>
</ul></li>
</ul>
</div>
</div>
</div>
<div id="outline-container-org498b37e" class="outline-4">
<h4 id="org498b37e"><span class="section-number-4">20.0.7</span> 榜单</h4>
<div class="outline-text-4" id="text-20-0-7">
</div>
<div id="outline-container-orge2deb48" class="outline-5">
<h5 id="orge2deb48"><span class="section-number-5">20.0.7.1</span> 根据 ec_id 获取榜单 def ec_get_rank_by_ec_id(ec_id)</h5>
</div>
<div id="outline-container-org0fc141f" class="outline-5">
<h5 id="org0fc141f"><span class="section-number-5">20.0.7.2</span> 获取粉丝得分、排名、距离上一名相差多少分 def ec_get_knight_rank_info(ec_id, uid)</h5>
</div>
<div id="outline-container-orge4b86c1" class="outline-5">
<h5 id="orge4b86c1"><span class="section-number-5">20.0.7.3</span> 获取粉丝得分 def ec_get_knight_score(ec_id, uid)</h5>
</div>
<div id="outline-container-orgf073e48" class="outline-5">
<h5 id="orgf073e48"><span class="section-number-5">20.0.7.4</span> 获取粉丝排名 def ec_get_knight_rank(ec_id, uid)</h5>
</div>
</div>
</div>

<div id="outline-container-org587d467" class="outline-2">
<h2 id="org587d467"><span class="section-number-2">21</span> 测试</h2>
<div class="outline-text-2" id="text-21">
<ul class="org-ul">
<li>测试主题名是表情文字的情况<br></li>
<li>主题表中的 info 字段<br></li>
</ul>
</div>
</div>


<div id="outline-container-org0d953bf" class="outline-2">
<h2 id="org0d953bf"><span class="section-number-2">22</span> 优化</h2>
<div class="outline-text-2" id="text-22">
</div>
<div id="outline-container-org760f5bf" class="outline-3">
<h3 id="org760f5bf"><span class="section-number-3">22.1</span> EventInfoView  db_ec_get_ec_awards_by_id 加缓存</h3>
</div>
<div id="outline-container-orga13ffd7" class="outline-3">
<h3 id="orga13ffd7"><span class="section-number-3">22.2</span> 结算加锁</h3>
</div>
<div id="outline-container-org76f42cc" class="outline-3">
<h3 id="org76f42cc"><span class="section-number-3">22.3</span> 结算。获取活动详情走缓存</h3>
</div>
<div id="outline-container-org7a2fa69" class="outline-3">
<h3 id="org7a2fa69"><span class="section-number-3">22.4</span> 结算。jump_url 改为 线上环境</h3>
</div>
<div id="outline-container-org5ecc9b8" class="outline-3">
<h3 id="org5ecc9b8"><span class="section-number-3">22.5</span> 结算。获取关注用户</h3>
</div>
<div id="outline-container-orgd53a1c6" class="outline-3">
<h3 id="orgd53a1c6"><span class="section-number-3">22.6</span> 结算。获取家族用户</h3>
</div>
<div id="outline-container-orgdf9caf9" class="outline-3">
<h3 id="orgdf9caf9"><span class="section-number-3">22.7</span> 结算。url 改为 线上环境</h3>
</div>
</div>
</div>
<div id="postamble" class="status">
<p>本笔记系统由
    <a href="">时中贺</a> 搭建和维护，使用
    <a href="https://www.gnu.org/software/emacs/">Emacs</a>
    <a href="http://orgmode.org/">Org mode</a> 编辑和构建
    <br />
    email: shi_zhonghe@163.com
</p>
<script src="file:/Users/he/notes/html/css/jquery-2.1.3.min.js"></script>
<script src="file:/Users/he/notes/html/css/main.js"></script>
</div>
</body>
</html>
