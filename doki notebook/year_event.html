<!DOCTYPE html>
<html lang="zh-CN">
<head>
<!-- 2020-01-15 Wed 11:51 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>年度活动</title>
<meta name="generator" content="Org mode">
<meta name="author" content="时中贺">
<link rel="stylesheet" type="text/css" href="http://www.langdebuqing.com/css/style.css" />
<link rel="shortcut icon" href="http://www.langdebuqing.com/images/favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="preamble" class="status">
<div id="navbar">
    <ul>
        <li id="site-master"><a href="http://www.langdebuqing.com">浪的不轻</a></li>
        <li><a class="navbar-item" href="http://www.langdebuqing.com/gallery.html">Gallery</a> </li>
        <li><a class="navbar-item" href="http://www.langdebuqing.com/notebooks.html">Notebooks</a> </li>
        <li><a class="navbar-item" href="http://www.langdebuqing.com/links.html">Links</a> </li>
        <li><a class="navbar-item" href="http://www.langdebuqing.com/about.html">About</a> </li>
        <li class="search">
            <form action="http://google.com/search" method="get" accept-charset="utf-8">
                <input type="search" id="search" name="q" autocomplete="off" maxlength="30" placeholder="Google..">
                <input type="hidden" name="q" value="site:www.langdebuqing.com">
            </form>
        </li>
    </ul>
</div>
</div>
<div id="content">
<h1 class="title">年度活动</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org751c370">1. 需求</a>
<ul>
<li><a href="#org372fccf">1.1. 庆生领取装饰</a>
<ul>
<li><a href="#orgc3d1e7e">1.1.1. 每个人只能领取一次</a></li>
<li><a href="#orge6c09e5">1.1.2. 奖励（需要领取才能获取）</a>
<ul>
<li><a href="#orge8e285b">1.1.2.1. 1-3 周年聊天纪念框</a></li>
<li><a href="#orgb098f0f">1.1.2.2. 2-3 周年开播纪念框</a></li>
<li><a href="#orgc9ecb89">1.1.2.3. 土豪专属入室特效下发吗？怎么下发</a></li>
</ul>
</li>
<li><a href="#org864b977">1.1.3. 奖励（无需领取就能获取）</a>
<ul>
<li><a href="#org603c15d">1.1.3.1. 3-3 周年登陆奖励加倍</a></li>
</ul>
</li>
<li><a href="#org66bd713">1.1.4. 装饰奖励领取后直接佩戴，不作为背包礼物下发</a></li>
<li><a href="#org335c771">1.1.5. 1-3、2-3、3-3 是什么意思？</a></li>
<li><a href="#org3782a0b">1.1.6. 奖励的活动时限都是活动结束时间</a></li>
<li><a href="#org4acc473">1.1.7. 聊天框、主播头像框现在是否有该装饰？</a></li>
<li><a href="#orge97fd85">1.1.8. 需求上 5 张图片有什么区别？</a></li>
</ul>
</li>
<li><a href="#org754c373">1.2. 阶段一</a>
<ul>
<li><a href="#orgc4de592">1.2.1. 一回战榜单</a>
<ul>
<li><a href="#orgcbd12b8">1.2.1.1. 总榜</a></li>
<li><a href="#orgcd0f332">1.2.1.2. 今日日榜、昨日日榜</a></li>
<li><a href="#org8532e71">1.2.1.3. 没有日榜</a></li>
<li><a href="#orgbcbadad">1.2.1.4. 榜单加成</a></li>
<li><a href="#org27f816d">1.2.1.5. 有直播间弹窗？直播间弹窗展示哪个榜单？</a></li>
<li><a href="#org890474b">1.2.1.6. 晋级：总榜的 4 个榜单前 30 名晋级到下一回合。男、女榜晋级</a></li>
</ul>
</li>
<li><a href="#org6646d45">1.2.2. 二回战榜单</a>
<ul>
<li><a href="#org0327e3d">1.2.2.1. 总榜</a></li>
<li><a href="#org0d2d7b1">1.2.2.2. 榜单加成：无。需求文档和思维导图有差异</a></li>
<li><a href="#orgf1f2f90">1.2.2.3. 有直播间弹窗？直播间弹窗展示哪个榜单？</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org1a30b71">1.3. 阶段二</a>
<ul>
<li><a href="#orgade6b4c">1.3.1. 家族影响力点数榜</a>
<ul>
<li><a href="#orga9bed82">1.3.1.1. 家族群聊是否砍掉？</a></li>
<li><a href="#orgd1c4267">1.3.1.2. 影响力点数获取方式</a></li>
<li><a href="#org5f3c6e0">1.3.1.3. 距离上一名还差 xxx pt 在 h5 中最好砍掉，可以在直播间弹窗中</a></li>
<li><a href="#orgfd5b21d">1.3.1.4. 有直播间弹窗？</a></li>
<li><a href="#org6cd402f">1.3.1.5. 主播可以有多个家族吗？</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org2b51fb6">1.4. 阶段三</a>
<ul>
<li><a href="#org1c7c421">1.4.1. 一回战</a>
<ul>
<li><a href="#org4219211">1.4.1.1. 活动类型：家族 pk ？pk 同屏？</a></li>
<li><a href="#org7310bf2">1.4.1.2. 家族对战榜单</a></li>
</ul>
</li>
<li><a href="#org5f54e66">1.4.2. 二回战</a>
<ul>
<li><a href="#org59c5132">1.4.2.1. 活动类型：吸金主播？</a></li>
<li><a href="#org6883240">1.4.2.2. 总榜</a></li>
<li><a href="#org589ed51">1.4.2.3. 日榜</a></li>
<li><a href="#org88a2937">1.4.2.4. 晋级</a></li>
<li><a href="#org18773af">1.4.2.5. 与日榜进行结合什么意思？</a></li>
</ul>
</li>
<li><a href="#orgdcfc3d6">1.4.3. 三回战</a>
<ul>
<li><a href="#orgdfce3a4">1.4.3.1. 活动类型：吸金主播</a></li>
<li><a href="#org1346185">1.4.3.2. 总榜</a></li>
<li><a href="#orgf43adc0">1.4.3.3. 小时榜</a></li>
<li><a href="#orgdcce08e">1.4.3.4. 总榜加成</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgd8481fa">2. 第一阶段代码实现</a>
<ul>
<li><a href="#orged08295">2.1. round1 活动配置：新人男榜、新人女榜配置一个活动 round1_A；男榜、女榜配置一个活动 round1_B</a></li>
<li><a href="#orgf801916">2.2. round2 活动配置：新人男榜、新人女榜配置一个日榜类型的 rich_anchor 活动 round2_A；男榜、女榜配置一个日榜类型的 rich_anchor 活动 round2_B</a></li>
<li><a href="#org1d8d9c9">2.3. rich_anchor 添加日榜概念：日榜 rich_anchor 活动，在活动期间每天都有一个日榜榜单、和一个总榜榜单。日榜实时计算，总榜非实时计算，日榜和总榜对应有加成关系</a></li>
<li><a href="#org9b11ce9">2.4. 日榜晋级：round1_A 晋级到 round2_A 总榜后，还需要晋级到 round2_A 的每一个日榜</a></li>
<li><a href="#org626a573">2.5. promote 接口调整：判断一个 rich_anchor 活动如果是日榜类型的话，在 master 中自动生成昨日日榜和今日日榜 event_name、board 等，start_time、end_time 为日榜当天的开始时间、结束时间</a></li>
<li><a href="#orgc8a099c">2.6. 新增一个定时任务：每天执行一次，把日榜加算到总榜中，需要考虑 board</a></li>
</ul>
</li>
<li><a href="#org20e04e7">3. 第三阶段代码实现</a>
<ul>
<li><a href="#orgd13a2a2">3.1. <span class="done DONE">DONE</span> round1 家族对战配置</a></li>
<li><a href="#orgcf495fc">3.2. <span class="done DONE">DONE</span> 1-&gt;2晋级赛定时任务：分数完全继承</a></li>
<li><a href="#org1cc28dd">3.3. <span class="done DONE">DONE</span> 2-&gt;3晋级赛定时任务：吸金主播晋级到日榜时，需要分数按比例继承到下一阶段</a></li>
<li><a href="#orgeb58624">3.4. <span class="done DONE">DONE</span> 晋级赛接口：调整今日榜、昨日榜返回的位置</a></li>
<li><a href="#org1edf6ab">3.5. <span class="done DONE">DONE</span> 日榜结算时，没有配置 valid_list 时，默认 board 使用 0</a></li>
<li><a href="#org859f6cd">3.6. <span class="done DONE">DONE</span> family_battle 送礼加分时，取 topk 用户，其它用户不进行加分；</a></li>
<li><a href="#org34ae537">3.7. <span class="done DONE">DONE</span> family_battle 结算时，根据指定加分规则，加分到吸金主播榜单中。</a></li>
<li><a href="#orgb2934e8">3.8. <span class="done DONE">DONE</span> 第三阶段返回总榜，接口增加一个参数来返回总榜的数据</a></li>
<li><a href="#org659338e">3.9. <span class="done DONE">DONE</span> 小时榜直播间弹窗，获取总榜直播间弹窗</a></li>
<li><a href="#org9315604">3.10. <span class="done DONE">DONE</span> 小时榜骑士榜，获取总榜骑士榜</a></li>
<li><a href="#org604965b">3.11. <span class="done DONE">DONE</span> 注意：第一个小阶段不要忘记提交代码时添加 topk 用户</a></li>
<li><a href="#org32180e9">3.12. <span class="done DONE">DONE</span> 注意：需要对晋级到 yc2019_round3_1 的主播执行晋级操作，否则会加榜单失败</a></li>
<li><a href="#orgf975454">3.13. <span class="done DONE">DONE</span> 注意：小时榜有礼物数量限制，是否调整，调整</a></li>
<li><a href="#org2ef6cf6">3.14. <span class="done DONE">DONE</span> 注意：直播间弹窗 end_time 是 2.6 转盘的需求</a></li>
<li><a href="#orge8dfed5">3.15. <span class="done DONE">DONE</span> 额外：第二阶段中每日送礼限制应该和 event_name 绑定在一起</a></li>
<li><a href="#org05c0a2d">3.16. <span class="todo TODO">TODO</span> 小时榜是否和转盘二期小时榜需求有冲突</a></li>
<li><a href="#org7bb57d6">3.17. <span class="done DONE">DONE</span> 清理之前写死的无用代码。events 吸金主播、吸金主播骑士榜已清理。评论指定文案加分，注释掉</a></li>
</ul>
</li>
<li><a href="#org9eab8af">4. 第三阶段重启服务</a></li>
</ul>
</div>
</div>

<div id="outline-container-org751c370" class="outline-2">
<h2 id="org751c370"><span class="section-number-2">1</span> 需求</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org372fccf" class="outline-3">
<h3 id="org372fccf"><span class="section-number-3">1.1</span> 庆生领取装饰</h3>
<div class="outline-text-3" id="text-1-1">
</div>
<div id="outline-container-orgc3d1e7e" class="outline-4">
<h4 id="orgc3d1e7e"><span class="section-number-4">1.1.1</span> 每个人只能领取一次</h4>
</div>
<div id="outline-container-orge6c09e5" class="outline-4">
<h4 id="orge6c09e5"><span class="section-number-4">1.1.2</span> 奖励（需要领取才能获取）</h4>
<div class="outline-text-4" id="text-1-1-2">
</div>
<div id="outline-container-orge8e285b" class="outline-5">
<h5 id="orge8e285b"><span class="section-number-5">1.1.2.1</span> 1-3 周年聊天纪念框</h5>
</div>
<div id="outline-container-orgb098f0f" class="outline-5">
<h5 id="orgb098f0f"><span class="section-number-5">1.1.2.2</span> 2-3 周年开播纪念框</h5>
</div>
<div id="outline-container-orgc9ecb89" class="outline-5">
<h5 id="orgc9ecb89"><span class="section-number-5">1.1.2.3</span> 土豪专属入室特效下发吗？怎么下发</h5>
</div>
</div>
<div id="outline-container-org864b977" class="outline-4">
<h4 id="org864b977"><span class="section-number-4">1.1.3</span> 奖励（无需领取就能获取）</h4>
<div class="outline-text-4" id="text-1-1-3">
</div>
<div id="outline-container-org603c15d" class="outline-5">
<h5 id="org603c15d"><span class="section-number-5">1.1.3.1</span> 3-3 周年登陆奖励加倍</h5>
</div>
</div>
<div id="outline-container-org66bd713" class="outline-4">
<h4 id="org66bd713"><span class="section-number-4">1.1.4</span> 装饰奖励领取后直接佩戴，不作为背包礼物下发</h4>
</div>
<div id="outline-container-org335c771" class="outline-4">
<h4 id="org335c771"><span class="section-number-4">1.1.5</span> 1-3、2-3、3-3 是什么意思？</h4>
</div>
<div id="outline-container-org3782a0b" class="outline-4">
<h4 id="org3782a0b"><span class="section-number-4">1.1.6</span> 奖励的活动时限都是活动结束时间</h4>
</div>
<div id="outline-container-org4acc473" class="outline-4">
<h4 id="org4acc473"><span class="section-number-4">1.1.7</span> 聊天框、主播头像框现在是否有该装饰？</h4>
</div>
<div id="outline-container-orge97fd85" class="outline-4">
<h4 id="orge97fd85"><span class="section-number-4">1.1.8</span> 需求上 5 张图片有什么区别？</h4>
</div>
</div>
<div id="outline-container-org754c373" class="outline-3">
<h3 id="org754c373"><span class="section-number-3">1.2</span> 阶段一</h3>
<div class="outline-text-3" id="text-1-2">
</div>
<div id="outline-container-orgc4de592" class="outline-4">
<h4 id="orgc4de592"><span class="section-number-4">1.2.1</span> 一回战榜单</h4>
<div class="outline-text-4" id="text-1-2-1">
</div>
<div id="outline-container-orgcbd12b8" class="outline-5">
<h5 id="orgcbd12b8"><span class="section-number-5">1.2.1.1</span> 总榜</h5>
<div class="outline-text-5" id="text-1-2-1-1">
</div>
<ol class="org-ol">
<li><a id="orgb13eac8"></a>女榜、男榜<br></li>
<li><a id="org59f1014"></a>新人男榜、新人女榜：两种实现方案<br>
<div class="outline-text-6" id="text-1-2-1-1-2">
<ul class="org-ul">
<li>单独作为榜单：根据性别划分 board，然后添加一条配置 "anchor_level_limit": ["&lt;", 21]<br></li>
<li>作为男榜、女榜的子榜：当榜单加载到 redis zset 中时，过滤出新人，存放到 redis zset。该种方式不支持晋级<br></li>
</ul>
</div>
</li>
<li><a id="org78f467a"></a>注册时间新开发<br></li>
</ol>
</div>
<div id="outline-container-orgcd0f332" class="outline-5">
<h5 id="orgcd0f332"><span class="section-number-5">1.2.1.2</span> 今日日榜、昨日日榜</h5>
<div class="outline-text-5" id="text-1-2-1-2">
</div>
<ol class="org-ol">
<li><a id="org1de57cd"></a>新人男榜、新人女榜<br></li>
<li><a id="org16549b2"></a>女榜、男榜<br></li>
</ol>
</div>
<div id="outline-container-org8532e71" class="outline-5">
<h5 id="org8532e71"><span class="section-number-5">1.2.1.3</span> 没有日榜</h5>
</div>
<div id="outline-container-orgbcbadad" class="outline-5">
<h5 id="orgbcbadad"><span class="section-number-5">1.2.1.4</span> 榜单加成</h5>
<div class="outline-text-5" id="text-1-2-1-4">
</div>
<ol class="org-ol">
<li><a id="orgd8ccd5c"></a>当日日榜排名计算加成系数，把本日的分数加成后加算到总榜。不能实时加总榜<br></li>
<li><a id="org4dfe289"></a>确定加成系数<br></li>
</ol>
</div>
<div id="outline-container-org27f816d" class="outline-5">
<h5 id="org27f816d"><span class="section-number-5">1.2.1.5</span> 有直播间弹窗？直播间弹窗展示哪个榜单？</h5>
</div>
<div id="outline-container-org890474b" class="outline-5">
<h5 id="org890474b"><span class="section-number-5">1.2.1.6</span> 晋级：总榜的 4 个榜单前 30 名晋级到下一回合。男、女榜晋级</h5>
</div>
</div>
<div id="outline-container-org6646d45" class="outline-4">
<h4 id="org6646d45"><span class="section-number-4">1.2.2</span> 二回战榜单</h4>
<div class="outline-text-4" id="text-1-2-2">
</div>
<div id="outline-container-org0327e3d" class="outline-5">
<h5 id="org0327e3d"><span class="section-number-5">1.2.2.1</span> 总榜</h5>
<div class="outline-text-5" id="text-1-2-2-1">
</div>
<ol class="org-ol">
<li><a id="orgb49d754"></a>男榜、女榜<br></li>
<li><a id="orgd3294a3"></a>新人男榜、新人女榜<br></li>
<li><a id="org2f125dd"></a>活动结束后，放大展示各个榜单 top1<br></li>
</ol>
</div>
<div id="outline-container-org0d2d7b1" class="outline-5">
<h5 id="org0d2d7b1"><span class="section-number-5">1.2.2.2</span> 榜单加成：无。需求文档和思维导图有差异</h5>
</div>
<div id="outline-container-orgf1f2f90" class="outline-5">
<h5 id="orgf1f2f90"><span class="section-number-5">1.2.2.3</span> 有直播间弹窗？直播间弹窗展示哪个榜单？</h5>
</div>
</div>
</div>
<div id="outline-container-org1a30b71" class="outline-3">
<h3 id="org1a30b71"><span class="section-number-3">1.3</span> 阶段二</h3>
<div class="outline-text-3" id="text-1-3">
</div>
<div id="outline-container-orgade6b4c" class="outline-4">
<h4 id="orgade6b4c"><span class="section-number-4">1.3.1</span> 家族影响力点数榜</h4>
<div class="outline-text-4" id="text-1-3-1">
</div>
<div id="outline-container-orga9bed82" class="outline-5">
<h5 id="orga9bed82"><span class="section-number-5">1.3.1.1</span> 家族群聊是否砍掉？</h5>
</div>
<div id="outline-container-orgd1c4267" class="outline-5">
<h5 id="orgd1c4267"><span class="section-number-5">1.3.1.2</span> 影响力点数获取方式</h5>
<div class="outline-text-5" id="text-1-3-1-2">
<ul class="org-ul">
<li>在家族群聊中投票，+100 家族影响力点数。一个人给一个家族每天只能投票一次，一个人每天可以给多个家族投票<br></li>
<li>主播开播，为主播所在家族 +100 家族影响力点数。每个主播每天只能为该主播家族加分一次？逻辑确认<br></li>
</ul>
</div>
</div>
<div id="outline-container-org5f3c6e0" class="outline-5">
<h5 id="org5f3c6e0"><span class="section-number-5">1.3.1.3</span> 距离上一名还差 xxx pt 在 h5 中最好砍掉，可以在直播间弹窗中</h5>
</div>
<div id="outline-container-orgfd5b21d" class="outline-5">
<h5 id="orgfd5b21d"><span class="section-number-5">1.3.1.4</span> 有直播间弹窗？</h5>
</div>
<div id="outline-container-org6cd402f" class="outline-5">
<h5 id="org6cd402f"><span class="section-number-5">1.3.1.5</span> 主播可以有多个家族吗？</h5>
</div>
</div>
</div>
<div id="outline-container-org2b51fb6" class="outline-3">
<h3 id="org2b51fb6"><span class="section-number-3">1.4</span> 阶段三</h3>
<div class="outline-text-3" id="text-1-4">
</div>
<div id="outline-container-org1c7c421" class="outline-4">
<h4 id="org1c7c421"><span class="section-number-4">1.4.1</span> 一回战</h4>
<div class="outline-text-4" id="text-1-4-1">
</div>
<div id="outline-container-org4219211" class="outline-5">
<h5 id="org4219211"><span class="section-number-5">1.4.1.1</span> 活动类型：家族 pk ？pk 同屏？</h5>
</div>
<div id="outline-container-org7310bf2" class="outline-5">
<h5 id="org7310bf2"><span class="section-number-5">1.4.1.2</span> 家族对战榜单</h5>
<div class="outline-text-5" id="text-1-4-1-2">
</div>
<ol class="org-ol">
<li><a id="org2807321"></a>榜单实现类型：吸金主播<br></li>
<li><a id="orga9b4b32"></a>加分方式<br>
<div class="outline-text-6" id="text-1-4-1-2-2">
<ul class="org-ul">
<li>pk 对战双方收礼总额和加成系数有一个映射关系：factor = map(total_score)<br></li>
<li>主播 A 分数 = A_score * factor<br></li>
</ul>
</div>
</li>
<li><a id="org0125306"></a>晋级<br>
<div class="outline-text-6" id="text-1-4-1-2-3">
<ul class="org-ul">
<li>前 40 名晋级到下一回合<br></li>
<li>分数继承到下个回合<br></li>
<li>骑士榜是否继承？最好不继承<br></li>
</ul>
</div>
</li>
<li><a id="org0ed6860"></a>pk 历史分为 DAY1 DAY2 DAY3 通过接口返回<br></li>
</ol>
</div>
</div>
<div id="outline-container-org5f54e66" class="outline-4">
<h4 id="org5f54e66"><span class="section-number-4">1.4.2</span> 二回战</h4>
<div class="outline-text-4" id="text-1-4-2">
</div>
<div id="outline-container-org59c5132" class="outline-5">
<h5 id="org59c5132"><span class="section-number-5">1.4.2.1</span> 活动类型：吸金主播？</h5>
</div>
<div id="outline-container-org6883240" class="outline-5">
<h5 id="org6883240"><span class="section-number-5">1.4.2.2</span> 总榜</h5>
</div>
<div id="outline-container-org589ed51" class="outline-5">
<h5 id="org589ed51"><span class="section-number-5">1.4.2.3</span> 日榜</h5>
<div class="outline-text-5" id="text-1-4-2-3">
<ul class="org-ul">
<li>昨日榜<br></li>
<li>今日榜<br></li>
</ul>
</div>
</div>
<div id="outline-container-org88a2937" class="outline-5">
<h5 id="org88a2937"><span class="section-number-5">1.4.2.4</span> 晋级</h5>
<div class="outline-text-5" id="text-1-4-2-4">
<ul class="org-ul">
<li>前 20 名晋级<br></li>
<li>分数按照名次映射的系数进行加成，继承到下个回合<br></li>
</ul>
</div>
</div>
<div id="outline-container-org18773af" class="outline-5">
<h5 id="org18773af"><span class="section-number-5">1.4.2.5</span> 与日榜进行结合什么意思？</h5>
</div>
</div>
<div id="outline-container-orgdcfc3d6" class="outline-4">
<h4 id="orgdcfc3d6"><span class="section-number-4">1.4.3</span> 三回战</h4>
<div class="outline-text-4" id="text-1-4-3">
</div>
<div id="outline-container-orgdfce3a4" class="outline-5">
<h5 id="orgdfce3a4"><span class="section-number-5">1.4.3.1</span> 活动类型：吸金主播</h5>
</div>
<div id="outline-container-org1346185" class="outline-5">
<h5 id="org1346185"><span class="section-number-5">1.4.3.2</span> 总榜</h5>
<div class="outline-text-5" id="text-1-4-3-2">
<p>
总榜分数 = 各个小时榜分数累加，以及小时榜第一名前 15min 加成<br>
</p>
</div>
</div>
<div id="outline-container-orgf43adc0" class="outline-5">
<h5 id="orgf43adc0"><span class="section-number-5">1.4.3.3</span> 小时榜</h5>
<div class="outline-text-5" id="text-1-4-3-3">
<ul class="org-ul">
<li>本小时<br></li>
<li>上小时<br></li>
<li>小时榜第一名获得下个小时的总榜分数加成，但不能影响下个小时小时榜排名<br></li>
</ul>
</div>
</div>
<div id="outline-container-orgdcce08e" class="outline-5">
<h5 id="orgdcce08e"><span class="section-number-5">1.4.3.4</span> 总榜加成</h5>
<div class="outline-text-5" id="text-1-4-3-4">
<ul class="org-ul">
<li>小时榜第一名获得下个小时的总榜分数加成，但不能影响下个小时小时榜排名。需要确定能不能做<br></li>
<li>确定加成系数<br></li>
</ul>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd8481fa" class="outline-2">
<h2 id="orgd8481fa"><span class="section-number-2">2</span> 第一阶段代码实现</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orged08295" class="outline-3">
<h3 id="orged08295"><span class="section-number-3">2.1</span> round1 活动配置：新人男榜、新人女榜配置一个活动 round1_A；男榜、女榜配置一个活动 round1_B</h3>
<div class="outline-text-3" id="text-2-1">
<p>
新人男榜、新人女榜<br>
</p>
<div class="org-src-container">
<pre class="src src-js">{
    <span style="color: #00afaf;">"auto_register"</span>: 0,
    <span style="color: #00afaf;">"board_setting"</span>: {
        <span style="color: #00afaf;">"valid_list"</span>: [0, 1]
    },
    <span style="color: #00afaf;">"larger_ctime_limit"</span>: <span style="color: #00afaf;">"2019-01-09 23:00:00"</span>,
    <span style="color: #00afaf;">"default_board_setting"</span>: {
        <span style="color: #00afaf;">"default_male_board"</span>: 1,
        <span style="color: #00afaf;">"default_female_board"</span>: 0
    },
    <span style="color: #00afaf;">"need_promote_status"</span>: 1,
    <span style="color: #00afaf;">"need_anchor_knights_board"</span>: 1,
    <span style="color: #00afaf;">"promote_event_type"</span>: 1,
    <span style="color: #00afaf;">"gifts_setting"</span>: {}
}
</pre>
</div>

<p>
男榜、女榜<br>
</p>
<div class="org-src-container">
<pre class="src src-js">{
    <span style="color: #00afaf;">"auto_register"</span>: 0,
    <span style="color: #00afaf;">"board_setting"</span>: {
        <span style="color: #00afaf;">"valid_list"</span>: [0, 1]
    },
    <span style="color: #00afaf;">"default_board_setting"</span>: {
        <span style="color: #00afaf;">"default_male_board"</span>: 1,
        <span style="color: #00afaf;">"default_female_board"</span>: 0
    },
    <span style="color: #00afaf;">"need_promote_status"</span>: 1,
    <span style="color: #00afaf;">"need_anchor_knights_board"</span>: 1,
    <span style="color: #00afaf;">"promote_event_type"</span>: 1,
    <span style="color: #00afaf;">"gifts_setting"</span>: {}
}
</pre>
</div>

<!-- This HTML table template is generated by emacs 26.1 -->
<table border="1">
  <tr>
    <td align="left" valign="top">
      &nbsp;uid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;screen_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;gender&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;display_id&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;ctime&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;u2572271555577408120001317&nbsp;<br />
      &nbsp;u4361101562832368120001324&nbsp;<br />
      &nbsp;u4605521547039481120001298&nbsp;<br />
      &nbsp;u8029551547033664120001360&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;shi_zhonghe&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;qianye&nbsp;lin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;腻腻腻腻酱&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;王广宇&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;770955577&nbsp;<br />
      &nbsp;&nbsp;776062832&nbsp;<br />
      &nbsp;&nbsp;765047039&nbsp;<br />
      &nbsp;&nbsp;764947033&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;2019-04-18&nbsp;08:50:09&nbsp;<br />
      &nbsp;2019-07-11&nbsp;08:06:08&nbsp;<br />
      &nbsp;2019-01-09&nbsp;13:11:21&nbsp;<br />
      &nbsp;2019-01-09&nbsp;11:34:25&nbsp;
    </td>
  </tr>
</table>
</div>
</div>

<div id="outline-container-orgf801916" class="outline-3">
<h3 id="orgf801916"><span class="section-number-3">2.2</span> round2 活动配置：新人男榜、新人女榜配置一个日榜类型的 rich_anchor 活动 round2_A；男榜、女榜配置一个日榜类型的 rich_anchor 活动 round2_B</h3>
<div class="outline-text-3" id="text-2-2">
<p>
新人男榜、新人女榜<br>
</p>
<div class="org-src-container">
<pre class="src src-js">{
    <span style="color: #00afaf;">"auto_register"</span>: 0,
    <span style="color: #00afaf;">"daily"</span>: 1,
    <span style="color: #00afaf;">"daily_buff"</span>: [1.2, 1.1],
    <span style="color: #00afaf;">"need_promote_status"</span>: 1,
    <span style="color: #00afaf;">"promote_event_type"</span>: 1,
    <span style="color: #00afaf;">"need_anchor_knights_board"</span>: 1,
    <span style="color: #00afaf;">"board_setting"</span>: {
        <span style="color: #00afaf;">"valid_list"</span>: [0, 1]
    },
    <span style="color: #00afaf;">"gifts_setting"</span>: {}
}
</pre>
</div>

<p>
男榜、女榜<br>
</p>
<div class="org-src-container">
<pre class="src src-js">{
    <span style="color: #00afaf;">"auto_register"</span>: 0,
    <span style="color: #00afaf;">"daily"</span>: 1,
    <span style="color: #00afaf;">"daily_buff"</span>: [1.2, 1.1],
    <span style="color: #00afaf;">"promote_event_type"</span>: 1,
    <span style="color: #00afaf;">"need_anchor_knights_board"</span>: 1,
    <span style="color: #00afaf;">"board_setting"</span>: {
        <span style="color: #00afaf;">"valid_list"</span>: [0, 1]
    },
    <span style="color: #00afaf;">"gifts_setting"</span>: {}
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org1d8d9c9" class="outline-3">
<h3 id="org1d8d9c9"><span class="section-number-3">2.3</span> rich_anchor 添加日榜概念：日榜 rich_anchor 活动，在活动期间每天都有一个日榜榜单、和一个总榜榜单。日榜实时计算，总榜非实时计算，日榜和总榜对应有加成关系</h3>
</div>
<div id="outline-container-org9b11ce9" class="outline-3">
<h3 id="org9b11ce9"><span class="section-number-3">2.4</span> 日榜晋级：round1_A 晋级到 round2_A 总榜后，还需要晋级到 round2_A 的每一个日榜</h3>
<div class="outline-text-3" id="text-2-4">
<div class="org-src-container">
<pre class="src src-js">[
    {
        <span style="color: #00afaf;">"promote_type"</span>: <span style="color: #00afaf;">"daily"</span>,
        <span style="color: #00afaf;">"from_event"</span>: <span style="color: #00afaf;">"yc2019_round1_1_new"</span>,
        <span style="color: #00afaf;">"to_event"</span>: <span style="color: #00afaf;">"yc2019_round1_2_new"</span>,
        <span style="color: #00afaf;">"from_board"</span>: [0, 1],
        <span style="color: #00afaf;">"to_board"</span>: [0, 1],
        <span style="color: #00afaf;">"promote_status"</span>: 1,
        <span style="color: #00afaf;">"count"</span>: [30, 30]
    },
    {
        <span style="color: #00afaf;">"promote_type"</span>: <span style="color: #00afaf;">"daily"</span>,
        <span style="color: #00afaf;">"from_event"</span>: <span style="color: #00afaf;">"yc2019_round1_1_all"</span>,
        <span style="color: #00afaf;">"to_event"</span>: <span style="color: #00afaf;">"yc2019_round1_2_all"</span>,
        <span style="color: #00afaf;">"from_board"</span>: [0, 1],
        <span style="color: #00afaf;">"to_board"</span>: [0, 1],
        <span style="color: #00afaf;">"promote_status"</span>: 1,
        <span style="color: #00afaf;">"count"</span>: [30, 30]
    }
]
</pre>
</div>
</div>
</div>
<div id="outline-container-org626a573" class="outline-3">
<h3 id="org626a573"><span class="section-number-3">2.5</span> promote 接口调整：判断一个 rich_anchor 活动如果是日榜类型的话，在 master 中自动生成昨日日榜和今日日榜 event_name、board 等，start_time、end_time 为日榜当天的开始时间、结束时间</h3>
</div>
<div id="outline-container-orgc8a099c" class="outline-3">
<h3 id="orgc8a099c"><span class="section-number-3">2.6</span> 新增一个定时任务：每天执行一次，把日榜加算到总榜中，需要考虑 board</h3>
</div>
</div>

<div id="outline-container-org20e04e7" class="outline-2">
<h2 id="org20e04e7"><span class="section-number-2">3</span> 第三阶段代码实现</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orgd13a2a2" class="outline-3">
<h3 id="orgd13a2a2"><span class="section-number-3">3.1</span> <span class="done DONE">DONE</span> round1 家族对战配置</h3>
<div class="outline-text-3" id="text-3-1">
<p>
添加吸金主播配置<br>
</p>
<div class="org-src-container">
<pre class="src src-js">{
    <span style="color: #00afaf;">"auto_register"</span>: 0,
    <span style="color: #00afaf;">"gifts_setting"</span>: {
        <span style="color: #00afaf;">"256"</span>: 0
    },
    <span style="color: #00afaf;">"need_promote_status"</span>: 1,
    <span style="color: #00afaf;">"need_anchor_knights_board"</span>: 0,
    <span style="color: #00afaf;">"promote_event_type"</span>: 1
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcf495fc" class="outline-3">
<h3 id="orgcf495fc"><span class="section-number-3">3.2</span> <span class="done DONE">DONE</span> 1-&gt;2晋级赛定时任务：分数完全继承</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">
<pre class="src src-js">[
    {
        <span style="color: #00afaf;">"promote_type"</span>: <span style="color: #00afaf;">"daily"</span>,
        <span style="color: #00afaf;">"from_event"</span>: <span style="color: #00afaf;">"yc2019_round3_1"</span>,
        <span style="color: #00afaf;">"to_event"</span>: <span style="color: #00afaf;">"yc2019_round3_2"</span>,
        <span style="color: #00afaf;">"from_board"</span>: [0],
        <span style="color: #00afaf;">"to_board"</span>: [0],
        <span style="color: #00afaf;">"promote_status"</span>: 1,
        <span style="color: #00afaf;">"count"</span>: [40],
        <span style="color: #00afaf;">"inherit_buff"</span>: [1]
    },
    {
        <span style="color: #00afaf;">"promote_type"</span>: <span style="color: #00afaf;">"normal"</span>,
        <span style="color: #00afaf;">"from_event"</span>: <span style="color: #00afaf;">"yc2019_round3_2"</span>,
        <span style="color: #00afaf;">"to_event"</span>: <span style="color: #00afaf;">"yc2019_round3_3"</span>,
        <span style="color: #00afaf;">"from_board"</span>: [0],
        <span style="color: #00afaf;">"to_board"</span>: [0],
        <span style="color: #00afaf;">"promote_status"</span>: 1,
        <span style="color: #00afaf;">"count"</span>: [20],
        <span style="color: #00afaf;">"inherit_buff"</span>: [0.3, 0.25, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.15]
    }
]
</pre>
</div>
</div>
</div>
<div id="outline-container-org1cc28dd" class="outline-3">
<h3 id="org1cc28dd"><span class="section-number-3">3.3</span> <span class="done DONE">DONE</span> 2-&gt;3晋级赛定时任务：吸金主播晋级到日榜时，需要分数按比例继承到下一阶段</h3>
</div>
<div id="outline-container-orgeb58624" class="outline-3">
<h3 id="orgeb58624"><span class="section-number-3">3.4</span> <span class="done DONE">DONE</span> 晋级赛接口：调整今日榜、昨日榜返回的位置</h3>
</div>
<div id="outline-container-org1edf6ab" class="outline-3">
<h3 id="org1edf6ab"><span class="section-number-3">3.5</span> <span class="done DONE">DONE</span> 日榜结算时，没有配置 valid_list 时，默认 board 使用 0</h3>
</div>
<div id="outline-container-org859f6cd" class="outline-3">
<h3 id="org859f6cd"><span class="section-number-3">3.6</span> <span class="done DONE">DONE</span> family_battle 送礼加分时，取 topk 用户，其它用户不进行加分；</h3>
</div>
<div id="outline-container-org34ae537" class="outline-3">
<h3 id="org34ae537"><span class="section-number-3">3.7</span> <span class="done DONE">DONE</span> family_battle 结算时，根据指定加分规则，加分到吸金主播榜单中。</h3>
</div>
<div id="outline-container-orgb2934e8" class="outline-3">
<h3 id="orgb2934e8"><span class="section-number-3">3.8</span> <span class="done DONE">DONE</span> 第三阶段返回总榜，接口增加一个参数来返回总榜的数据</h3>
</div>
<div id="outline-container-org659338e" class="outline-3">
<h3 id="org659338e"><span class="section-number-3">3.9</span> <span class="done DONE">DONE</span> 小时榜直播间弹窗，获取总榜直播间弹窗</h3>
</div>
<div id="outline-container-org9315604" class="outline-3">
<h3 id="org9315604"><span class="section-number-3">3.10</span> <span class="done DONE">DONE</span> 小时榜骑士榜，获取总榜骑士榜</h3>
</div>
<div id="outline-container-org604965b" class="outline-3">
<h3 id="org604965b"><span class="section-number-3">3.11</span> <span class="done DONE">DONE</span> 注意：第一个小阶段不要忘记提交代码时添加 topk 用户</h3>
</div>
<div id="outline-container-org32180e9" class="outline-3">
<h3 id="org32180e9"><span class="section-number-3">3.12</span> <span class="done DONE">DONE</span> 注意：需要对晋级到 yc2019_round3_1 的主播执行晋级操作，否则会加榜单失败</h3>
<div class="outline-text-3" id="text-3-12">
<div class="org-src-container">
<pre class="src src-python">events_cacher_v2.register_rich_anchor_contestant(<span style="color: #00afaf;">"yc2019_round3_1"</span>, <span style="color: #00afaf;">"u8960471526891737110001220"</span>, 0)
events_cacher_v2.register_rich_anchor_contestant(<span style="color: #00afaf;">"yc2019_round3_1"</span>, <span style="color: #00afaf;">"u2572271555577408120001317"</span>, 0)
events_cacher_v2.register_rich_anchor_contestant(<span style="color: #00afaf;">"yc2019_round3_1"</span>, <span style="color: #00afaf;">"u4778031560328976120001306"</span>, 0)
events_cacher_v2.register_rich_anchor_contestant(<span style="color: #00afaf;">"yc2019_round3_1"</span>, <span style="color: #00afaf;">"u9250061480925911020001233"</span>, 0)
events_cacher_v2.register_rich_anchor_contestant(<span style="color: #00afaf;">"yc2019_round3_1"</span>, <span style="color: #00afaf;">"u5075561559294511120001299"</span>, 0)
events_cacher_v2.sign_anchor_status(<span style="color: #00afaf;">"yc2019_round1_1_all"</span>, <span style="color: #00afaf;">"xxx"</span>, 1)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf975454" class="outline-3">
<h3 id="orgf975454"><span class="section-number-3">3.13</span> <span class="done DONE">DONE</span> 注意：小时榜有礼物数量限制，是否调整，调整</h3>
</div>
<div id="outline-container-org2ef6cf6" class="outline-3">
<h3 id="org2ef6cf6"><span class="section-number-3">3.14</span> <span class="done DONE">DONE</span> 注意：直播间弹窗 end_time 是 2.6 转盘的需求</h3>
</div>
<div id="outline-container-orge8dfed5" class="outline-3">
<h3 id="orge8dfed5"><span class="section-number-3">3.15</span> <span class="done DONE">DONE</span> 额外：第二阶段中每日送礼限制应该和 event_name 绑定在一起</h3>
</div>
<div id="outline-container-org05c0a2d" class="outline-3">
<h3 id="org05c0a2d"><span class="section-number-3">3.16</span> <span class="todo TODO">TODO</span> 小时榜是否和转盘二期小时榜需求有冲突</h3>
</div>
<div id="outline-container-org7bb57d6" class="outline-3">
<h3 id="org7bb57d6"><span class="section-number-3">3.17</span> <span class="done DONE">DONE</span> 清理之前写死的无用代码。events 吸金主播、吸金主播骑士榜已清理。评论指定文案加分，注释掉</h3>
</div>
</div>

<div id="outline-container-org9eab8af" class="outline-2">
<h2 id="org9eab8af"><span class="section-number-2">4</span> 第三阶段重启服务</h2>
<div class="outline-text-2" id="text-4">
<ul class="org-ul">
<li>http<br></li>
<li>important-events<br></li>
<li>very-important-events<br></li>
<li>schedule-event<br></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p>本笔记系统由
    <a href="">时中贺</a> 搭建和维护，使用
    <a href="https://www.gnu.org/software/emacs/">Emacs</a>
    <a href="http://orgmode.org/">Org mode</a> 编辑和构建
    <br />
    email: shi_zhonghe@163.com
</p>
<script src="http://www.langdebuqing.com/css/jquery-2.1.3.min.js"></script>
<script src="http://www.langdebuqing.com/css/main.js"></script>
</div>
</body>
</html>
