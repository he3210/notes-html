<!DOCTYPE html>
<html lang="zh-CN">
<head>
<!-- 2021-05-06 Thu 15:26 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>年度活动</title>
<meta name="generator" content="Org mode">
<meta name="author" content="时中贺">
<link rel="stylesheet" type="text/css" href="file:/Users/he/notes/html/css/style.css" />
<link rel="shortcut icon" href="file:/Users/he/notes/html/images/favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="preamble" class="status">
<div id="navbar">
    <ul>
        <li id="site-master"><a href="file:/Users/he/notes/html/index.html">浪的不轻</a></li>
        <li><a class="navbar-item" href="file:/Users/he/notes/html/gallery.html">Gallery</a> </li>
        <li><a class="navbar-item" href="file:/Users/he/notes/html/notebooks.html">Notebooks</a> </li>
        <li><a class="navbar-item" href="file:/Users/he/notes/html/links.html">Links</a> </li>
        <li><a class="navbar-item" href="file:/Users/he/notes/html/about.html">About</a> </li>
        <li class="search">
            <form action="http://google.com/search" method="get" accept-charset="utf-8">
                <input type="search" id="search" name="q" autocomplete="off" maxlength="30" placeholder="Google..">
                <input type="hidden" name="q" value="site:www.langdebuqing.com">
            </form>
        </li>
    </ul>
</div>
</div>
<div id="content">
<h1 class="title">年度活动</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgee36d6a">1. 需求</a>
<ul>
<li><a href="#org465624b">1.1. 庆生领取装饰</a>
<ul>
<li><a href="#orga7e2161">1.1.1. 每个人只能领取一次</a></li>
<li><a href="#org5317220">1.1.2. 奖励（需要领取才能获取）</a>
<ul>
<li><a href="#org161fa45">1.1.2.1. 1-3 周年聊天纪念框</a></li>
<li><a href="#orgc5feffc">1.1.2.2. 2-3 周年开播纪念框</a></li>
<li><a href="#orga75cacd">1.1.2.3. 土豪专属入室特效下发吗？怎么下发</a></li>
</ul>
</li>
<li><a href="#org35e0ec4">1.1.3. 奖励（无需领取就能获取）</a>
<ul>
<li><a href="#org6a43242">1.1.3.1. 3-3 周年登陆奖励加倍</a></li>
</ul>
</li>
<li><a href="#orgb99c211">1.1.4. 装饰奖励领取后直接佩戴，不作为背包礼物下发</a></li>
<li><a href="#orga92cf18">1.1.5. 1-3、2-3、3-3 是什么意思？</a></li>
<li><a href="#org0693357">1.1.6. 奖励的活动时限都是活动结束时间</a></li>
<li><a href="#orgaa2dede">1.1.7. 聊天框、主播头像框现在是否有该装饰？</a></li>
<li><a href="#org91e1fa8">1.1.8. 需求上 5 张图片有什么区别？</a></li>
</ul>
</li>
<li><a href="#org69b6003">1.2. 阶段一</a>
<ul>
<li><a href="#org376199a">1.2.1. 一回战榜单</a>
<ul>
<li><a href="#org4504f32">1.2.1.1. 总榜</a></li>
<li><a href="#org25ac0a6">1.2.1.2. 今日日榜、昨日日榜</a></li>
<li><a href="#org5447a4b">1.2.1.3. 没有日榜</a></li>
<li><a href="#org6d7582c">1.2.1.4. 榜单加成</a></li>
<li><a href="#org126fa0f">1.2.1.5. 有直播间弹窗？直播间弹窗展示哪个榜单？</a></li>
<li><a href="#org8e7efb7">1.2.1.6. 晋级：总榜的 4 个榜单前 30 名晋级到下一回合。男、女榜晋级</a></li>
</ul>
</li>
<li><a href="#orgb18333a">1.2.2. 二回战榜单</a>
<ul>
<li><a href="#org2d225d3">1.2.2.1. 总榜</a></li>
<li><a href="#org8bdee1f">1.2.2.2. 榜单加成：无。需求文档和思维导图有差异</a></li>
<li><a href="#orgc1eece5">1.2.2.3. 有直播间弹窗？直播间弹窗展示哪个榜单？</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgc1f7e7c">1.3. 阶段二</a>
<ul>
<li><a href="#orge8a8ac1">1.3.1. 家族影响力点数榜</a>
<ul>
<li><a href="#org8641879">1.3.1.1. 家族群聊是否砍掉？</a></li>
<li><a href="#org2a86de9">1.3.1.2. 影响力点数获取方式</a></li>
<li><a href="#org2c8395d">1.3.1.3. 距离上一名还差 xxx pt 在 h5 中最好砍掉，可以在直播间弹窗中</a></li>
<li><a href="#org5a3513f">1.3.1.4. 有直播间弹窗？</a></li>
<li><a href="#orgd9a424c">1.3.1.5. 主播可以有多个家族吗？</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org2131aa4">1.4. 阶段三</a>
<ul>
<li><a href="#orgcc50843">1.4.1. 一回战</a>
<ul>
<li><a href="#orgd54bd17">1.4.1.1. 活动类型：家族 pk ？pk 同屏？</a></li>
<li><a href="#org9900cd9">1.4.1.2. 家族对战榜单</a></li>
</ul>
</li>
<li><a href="#org78d3975">1.4.2. 二回战</a>
<ul>
<li><a href="#org38d936c">1.4.2.1. 活动类型：吸金主播？</a></li>
<li><a href="#org29622ae">1.4.2.2. 总榜</a></li>
<li><a href="#orga6e3697">1.4.2.3. 日榜</a></li>
<li><a href="#org372da1d">1.4.2.4. 晋级</a></li>
<li><a href="#org3763dd1">1.4.2.5. 与日榜进行结合什么意思？</a></li>
</ul>
</li>
<li><a href="#orgaed1691">1.4.3. 三回战</a>
<ul>
<li><a href="#orgf52826c">1.4.3.1. 活动类型：吸金主播</a></li>
<li><a href="#org721c4cd">1.4.3.2. 总榜</a></li>
<li><a href="#orgdb9ce9a">1.4.3.3. 小时榜</a></li>
<li><a href="#org07effcd">1.4.3.4. 总榜加成</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org9d0ff5a">2. 第一阶段代码实现</a>
<ul>
<li><a href="#org38fe2b6">2.1. round1 活动配置：新人男榜、新人女榜配置一个活动 round1_A；男榜、女榜配置一个活动 round1_B</a></li>
<li><a href="#org28ff4ec">2.2. round2 活动配置：新人男榜、新人女榜配置一个日榜类型的 rich_anchor 活动 round2_A；男榜、女榜配置一个日榜类型的 rich_anchor 活动 round2_B</a></li>
<li><a href="#org9aa1d0a">2.3. rich_anchor 添加日榜概念：日榜 rich_anchor 活动，在活动期间每天都有一个日榜榜单、和一个总榜榜单。日榜实时计算，总榜非实时计算，日榜和总榜对应有加成关系</a></li>
<li><a href="#orgc6d4151">2.4. 日榜晋级：round1_A 晋级到 round2_A 总榜后，还需要晋级到 round2_A 的每一个日榜</a></li>
<li><a href="#org64ae889">2.5. promote 接口调整：判断一个 rich_anchor 活动如果是日榜类型的话，在 master 中自动生成昨日日榜和今日日榜 event_name、board 等，start_time、end_time 为日榜当天的开始时间、结束时间</a></li>
<li><a href="#orgedb5bd1">2.6. 新增一个定时任务：每天执行一次，把日榜加算到总榜中，需要考虑 board</a></li>
</ul>
</li>
<li><a href="#org57e6453">3. 第三阶段代码实现</a>
<ul>
<li><a href="#org90f0eaa">3.1. <span class="done DONE">DONE</span> round1 家族对战配置</a></li>
<li><a href="#org8e50fec">3.2. <span class="done DONE">DONE</span> 1-&gt;2晋级赛定时任务：分数完全继承</a></li>
<li><a href="#orga908924">3.3. <span class="done DONE">DONE</span> 2-&gt;3晋级赛定时任务：吸金主播晋级到日榜时，需要分数按比例继承到下一阶段</a></li>
<li><a href="#org319b9f7">3.4. <span class="done DONE">DONE</span> 晋级赛接口：调整今日榜、昨日榜返回的位置</a></li>
<li><a href="#orgc2a6784">3.5. <span class="done DONE">DONE</span> 日榜结算时，没有配置 valid_list 时，默认 board 使用 0</a></li>
<li><a href="#org63b9573">3.6. <span class="done DONE">DONE</span> family_battle 送礼加分时，取 topk 用户，其它用户不进行加分；</a></li>
<li><a href="#org524ed56">3.7. <span class="done DONE">DONE</span> family_battle 结算时，根据指定加分规则，加分到吸金主播榜单中。</a></li>
<li><a href="#org6cdd455">3.8. <span class="done DONE">DONE</span> 第三阶段返回总榜，接口增加一个参数来返回总榜的数据</a></li>
<li><a href="#orgf943396">3.9. <span class="done DONE">DONE</span> 小时榜直播间弹窗，获取总榜直播间弹窗</a></li>
<li><a href="#org81fe4d9">3.10. <span class="done DONE">DONE</span> 小时榜骑士榜，获取总榜骑士榜</a></li>
<li><a href="#orge0c93ef">3.11. <span class="done DONE">DONE</span> 注意：第一个小阶段不要忘记提交代码时添加 topk 用户</a></li>
<li><a href="#orgf5c7347">3.12. <span class="done DONE">DONE</span> 注意：需要对晋级到 yc2019_round3_1 的主播执行晋级操作，否则会加榜单失败</a></li>
<li><a href="#org55231a1">3.13. <span class="done DONE">DONE</span> 注意：小时榜有礼物数量限制，是否调整，调整</a></li>
<li><a href="#org8eea8d7">3.14. <span class="done DONE">DONE</span> 注意：直播间弹窗 end_time 是 2.6 转盘的需求</a></li>
<li><a href="#orgbcb2fe5">3.15. <span class="done DONE">DONE</span> 额外：第二阶段中每日送礼限制应该和 event_name 绑定在一起</a></li>
<li><a href="#org2f58da6">3.16. <span class="todo TODO">TODO</span> 小时榜是否和转盘二期小时榜需求有冲突</a></li>
<li><a href="#org9a2b760">3.17. <span class="done DONE">DONE</span> 清理之前写死的无用代码。events 吸金主播、吸金主播骑士榜已清理。评论指定文案加分，注释掉</a></li>
</ul>
</li>
<li><a href="#org456a492">4. 第三阶段重启服务</a></li>
</ul>
</div>
</div>

<div id="outline-container-orgee36d6a" class="outline-2">
<h2 id="orgee36d6a"><span class="section-number-2">1</span> 需求</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org465624b" class="outline-3">
<h3 id="org465624b"><span class="section-number-3">1.1</span> 庆生领取装饰</h3>
<div class="outline-text-3" id="text-1-1">
</div>
<div id="outline-container-orga7e2161" class="outline-4">
<h4 id="orga7e2161"><span class="section-number-4">1.1.1</span> 每个人只能领取一次</h4>
</div>
<div id="outline-container-org5317220" class="outline-4">
<h4 id="org5317220"><span class="section-number-4">1.1.2</span> 奖励（需要领取才能获取）</h4>
<div class="outline-text-4" id="text-1-1-2">
</div>
<div id="outline-container-org161fa45" class="outline-5">
<h5 id="org161fa45"><span class="section-number-5">1.1.2.1</span> 1-3 周年聊天纪念框</h5>
</div>
<div id="outline-container-orgc5feffc" class="outline-5">
<h5 id="orgc5feffc"><span class="section-number-5">1.1.2.2</span> 2-3 周年开播纪念框</h5>
</div>
<div id="outline-container-orga75cacd" class="outline-5">
<h5 id="orga75cacd"><span class="section-number-5">1.1.2.3</span> 土豪专属入室特效下发吗？怎么下发</h5>
</div>
</div>
<div id="outline-container-org35e0ec4" class="outline-4">
<h4 id="org35e0ec4"><span class="section-number-4">1.1.3</span> 奖励（无需领取就能获取）</h4>
<div class="outline-text-4" id="text-1-1-3">
</div>
<div id="outline-container-org6a43242" class="outline-5">
<h5 id="org6a43242"><span class="section-number-5">1.1.3.1</span> 3-3 周年登陆奖励加倍</h5>
</div>
</div>
<div id="outline-container-orgb99c211" class="outline-4">
<h4 id="orgb99c211"><span class="section-number-4">1.1.4</span> 装饰奖励领取后直接佩戴，不作为背包礼物下发</h4>
</div>
<div id="outline-container-orga92cf18" class="outline-4">
<h4 id="orga92cf18"><span class="section-number-4">1.1.5</span> 1-3、2-3、3-3 是什么意思？</h4>
</div>
<div id="outline-container-org0693357" class="outline-4">
<h4 id="org0693357"><span class="section-number-4">1.1.6</span> 奖励的活动时限都是活动结束时间</h4>
</div>
<div id="outline-container-orgaa2dede" class="outline-4">
<h4 id="orgaa2dede"><span class="section-number-4">1.1.7</span> 聊天框、主播头像框现在是否有该装饰？</h4>
</div>
<div id="outline-container-org91e1fa8" class="outline-4">
<h4 id="org91e1fa8"><span class="section-number-4">1.1.8</span> 需求上 5 张图片有什么区别？</h4>
</div>
</div>
<div id="outline-container-org69b6003" class="outline-3">
<h3 id="org69b6003"><span class="section-number-3">1.2</span> 阶段一</h3>
<div class="outline-text-3" id="text-1-2">
</div>
<div id="outline-container-org376199a" class="outline-4">
<h4 id="org376199a"><span class="section-number-4">1.2.1</span> 一回战榜单</h4>
<div class="outline-text-4" id="text-1-2-1">
</div>
<div id="outline-container-org4504f32" class="outline-5">
<h5 id="org4504f32"><span class="section-number-5">1.2.1.1</span> 总榜</h5>
<div class="outline-text-5" id="text-1-2-1-1">
</div>
<ol class="org-ol">
<li><a id="org1d2b58f"></a>女榜、男榜<br></li>
<li><a id="orgf9cbfcb"></a>新人男榜、新人女榜：两种实现方案<br>
<div class="outline-text-6" id="text-1-2-1-1-2">
<ul class="org-ul">
<li>单独作为榜单：根据性别划分 board，然后添加一条配置 "anchor_level_limit": ["&lt;", 21]<br></li>
<li>作为男榜、女榜的子榜：当榜单加载到 redis zset 中时，过滤出新人，存放到 redis zset。该种方式不支持晋级<br></li>
</ul>
</div>
</li>
<li><a id="orga2dc181"></a>注册时间新开发<br></li>
</ol>
</div>
<div id="outline-container-org25ac0a6" class="outline-5">
<h5 id="org25ac0a6"><span class="section-number-5">1.2.1.2</span> 今日日榜、昨日日榜</h5>
<div class="outline-text-5" id="text-1-2-1-2">
</div>
<ol class="org-ol">
<li><a id="org9ab2276"></a>新人男榜、新人女榜<br></li>
<li><a id="org8770516"></a>女榜、男榜<br></li>
</ol>
</div>
<div id="outline-container-org5447a4b" class="outline-5">
<h5 id="org5447a4b"><span class="section-number-5">1.2.1.3</span> 没有日榜</h5>
</div>
<div id="outline-container-org6d7582c" class="outline-5">
<h5 id="org6d7582c"><span class="section-number-5">1.2.1.4</span> 榜单加成</h5>
<div class="outline-text-5" id="text-1-2-1-4">
</div>
<ol class="org-ol">
<li><a id="org6edfcab"></a>当日日榜排名计算加成系数，把本日的分数加成后加算到总榜。不能实时加总榜<br></li>
<li><a id="org5f0d0ae"></a>确定加成系数<br></li>
</ol>
</div>
<div id="outline-container-org126fa0f" class="outline-5">
<h5 id="org126fa0f"><span class="section-number-5">1.2.1.5</span> 有直播间弹窗？直播间弹窗展示哪个榜单？</h5>
</div>
<div id="outline-container-org8e7efb7" class="outline-5">
<h5 id="org8e7efb7"><span class="section-number-5">1.2.1.6</span> 晋级：总榜的 4 个榜单前 30 名晋级到下一回合。男、女榜晋级</h5>
</div>
</div>
<div id="outline-container-orgb18333a" class="outline-4">
<h4 id="orgb18333a"><span class="section-number-4">1.2.2</span> 二回战榜单</h4>
<div class="outline-text-4" id="text-1-2-2">
</div>
<div id="outline-container-org2d225d3" class="outline-5">
<h5 id="org2d225d3"><span class="section-number-5">1.2.2.1</span> 总榜</h5>
<div class="outline-text-5" id="text-1-2-2-1">
</div>
<ol class="org-ol">
<li><a id="org2947f1f"></a>男榜、女榜<br></li>
<li><a id="org166a818"></a>新人男榜、新人女榜<br></li>
<li><a id="org1d97726"></a>活动结束后，放大展示各个榜单 top1<br></li>
</ol>
</div>
<div id="outline-container-org8bdee1f" class="outline-5">
<h5 id="org8bdee1f"><span class="section-number-5">1.2.2.2</span> 榜单加成：无。需求文档和思维导图有差异</h5>
</div>
<div id="outline-container-orgc1eece5" class="outline-5">
<h5 id="orgc1eece5"><span class="section-number-5">1.2.2.3</span> 有直播间弹窗？直播间弹窗展示哪个榜单？</h5>
</div>
</div>
</div>
<div id="outline-container-orgc1f7e7c" class="outline-3">
<h3 id="orgc1f7e7c"><span class="section-number-3">1.3</span> 阶段二</h3>
<div class="outline-text-3" id="text-1-3">
</div>
<div id="outline-container-orge8a8ac1" class="outline-4">
<h4 id="orge8a8ac1"><span class="section-number-4">1.3.1</span> 家族影响力点数榜</h4>
<div class="outline-text-4" id="text-1-3-1">
</div>
<div id="outline-container-org8641879" class="outline-5">
<h5 id="org8641879"><span class="section-number-5">1.3.1.1</span> 家族群聊是否砍掉？</h5>
</div>
<div id="outline-container-org2a86de9" class="outline-5">
<h5 id="org2a86de9"><span class="section-number-5">1.3.1.2</span> 影响力点数获取方式</h5>
<div class="outline-text-5" id="text-1-3-1-2">
<ul class="org-ul">
<li>在家族群聊中投票，+100 家族影响力点数。一个人给一个家族每天只能投票一次，一个人每天可以给多个家族投票<br></li>
<li>主播开播，为主播所在家族 +100 家族影响力点数。每个主播每天只能为该主播家族加分一次？逻辑确认<br></li>
</ul>
</div>
</div>
<div id="outline-container-org2c8395d" class="outline-5">
<h5 id="org2c8395d"><span class="section-number-5">1.3.1.3</span> 距离上一名还差 xxx pt 在 h5 中最好砍掉，可以在直播间弹窗中</h5>
</div>
<div id="outline-container-org5a3513f" class="outline-5">
<h5 id="org5a3513f"><span class="section-number-5">1.3.1.4</span> 有直播间弹窗？</h5>
</div>
<div id="outline-container-orgd9a424c" class="outline-5">
<h5 id="orgd9a424c"><span class="section-number-5">1.3.1.5</span> 主播可以有多个家族吗？</h5>
</div>
</div>
</div>
<div id="outline-container-org2131aa4" class="outline-3">
<h3 id="org2131aa4"><span class="section-number-3">1.4</span> 阶段三</h3>
<div class="outline-text-3" id="text-1-4">
</div>
<div id="outline-container-orgcc50843" class="outline-4">
<h4 id="orgcc50843"><span class="section-number-4">1.4.1</span> 一回战</h4>
<div class="outline-text-4" id="text-1-4-1">
</div>
<div id="outline-container-orgd54bd17" class="outline-5">
<h5 id="orgd54bd17"><span class="section-number-5">1.4.1.1</span> 活动类型：家族 pk ？pk 同屏？</h5>
</div>
<div id="outline-container-org9900cd9" class="outline-5">
<h5 id="org9900cd9"><span class="section-number-5">1.4.1.2</span> 家族对战榜单</h5>
<div class="outline-text-5" id="text-1-4-1-2">
</div>
<ol class="org-ol">
<li><a id="orgcf3edea"></a>榜单实现类型：吸金主播<br></li>
<li><a id="orge44ac4d"></a>加分方式<br>
<div class="outline-text-6" id="text-1-4-1-2-2">
<ul class="org-ul">
<li>pk 对战双方收礼总额和加成系数有一个映射关系：factor = map(total_score)<br></li>
<li>主播 A 分数 = A_score * factor<br></li>
</ul>
</div>
</li>
<li><a id="orgf15328a"></a>晋级<br>
<div class="outline-text-6" id="text-1-4-1-2-3">
<ul class="org-ul">
<li>前 40 名晋级到下一回合<br></li>
<li>分数继承到下个回合<br></li>
<li>骑士榜是否继承？最好不继承<br></li>
</ul>
</div>
</li>
<li><a id="org306c3be"></a>pk 历史分为 DAY1 DAY2 DAY3 通过接口返回<br></li>
</ol>
</div>
</div>
<div id="outline-container-org78d3975" class="outline-4">
<h4 id="org78d3975"><span class="section-number-4">1.4.2</span> 二回战</h4>
<div class="outline-text-4" id="text-1-4-2">
</div>
<div id="outline-container-org38d936c" class="outline-5">
<h5 id="org38d936c"><span class="section-number-5">1.4.2.1</span> 活动类型：吸金主播？</h5>
</div>
<div id="outline-container-org29622ae" class="outline-5">
<h5 id="org29622ae"><span class="section-number-5">1.4.2.2</span> 总榜</h5>
</div>
<div id="outline-container-orga6e3697" class="outline-5">
<h5 id="orga6e3697"><span class="section-number-5">1.4.2.3</span> 日榜</h5>
<div class="outline-text-5" id="text-1-4-2-3">
<ul class="org-ul">
<li>昨日榜<br></li>
<li>今日榜<br></li>
</ul>
</div>
</div>
<div id="outline-container-org372da1d" class="outline-5">
<h5 id="org372da1d"><span class="section-number-5">1.4.2.4</span> 晋级</h5>
<div class="outline-text-5" id="text-1-4-2-4">
<ul class="org-ul">
<li>前 20 名晋级<br></li>
<li>分数按照名次映射的系数进行加成，继承到下个回合<br></li>
</ul>
</div>
</div>
<div id="outline-container-org3763dd1" class="outline-5">
<h5 id="org3763dd1"><span class="section-number-5">1.4.2.5</span> 与日榜进行结合什么意思？</h5>
</div>
</div>
<div id="outline-container-orgaed1691" class="outline-4">
<h4 id="orgaed1691"><span class="section-number-4">1.4.3</span> 三回战</h4>
<div class="outline-text-4" id="text-1-4-3">
</div>
<div id="outline-container-orgf52826c" class="outline-5">
<h5 id="orgf52826c"><span class="section-number-5">1.4.3.1</span> 活动类型：吸金主播</h5>
</div>
<div id="outline-container-org721c4cd" class="outline-5">
<h5 id="org721c4cd"><span class="section-number-5">1.4.3.2</span> 总榜</h5>
<div class="outline-text-5" id="text-1-4-3-2">
<p>
总榜分数 = 各个小时榜分数累加，以及小时榜第一名前 15min 加成<br>
</p>
</div>
</div>
<div id="outline-container-orgdb9ce9a" class="outline-5">
<h5 id="orgdb9ce9a"><span class="section-number-5">1.4.3.3</span> 小时榜</h5>
<div class="outline-text-5" id="text-1-4-3-3">
<ul class="org-ul">
<li>本小时<br></li>
<li>上小时<br></li>
<li>小时榜第一名获得下个小时的总榜分数加成，但不能影响下个小时小时榜排名<br></li>
</ul>
</div>
</div>
<div id="outline-container-org07effcd" class="outline-5">
<h5 id="org07effcd"><span class="section-number-5">1.4.3.4</span> 总榜加成</h5>
<div class="outline-text-5" id="text-1-4-3-4">
<ul class="org-ul">
<li>小时榜第一名获得下个小时的总榜分数加成，但不能影响下个小时小时榜排名。需要确定能不能做<br></li>
<li>确定加成系数<br></li>
</ul>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-org9d0ff5a" class="outline-2">
<h2 id="org9d0ff5a"><span class="section-number-2">2</span> 第一阶段代码实现</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org38fe2b6" class="outline-3">
<h3 id="org38fe2b6"><span class="section-number-3">2.1</span> round1 活动配置：新人男榜、新人女榜配置一个活动 round1_A；男榜、女榜配置一个活动 round1_B</h3>
<div class="outline-text-3" id="text-2-1">
<p>
新人男榜、新人女榜<br>
</p>
<div class="org-src-container">
<pre class="src src-js">{
    <span style="color: #00afaf;">"auto_register"</span>: 0,
    <span style="color: #00afaf;">"board_setting"</span>: {
        <span style="color: #00afaf;">"valid_list"</span>: [0, 1]
    },
    <span style="color: #00afaf;">"larger_ctime_limit"</span>: <span style="color: #00afaf;">"2019-01-09 23:00:00"</span>,
    <span style="color: #00afaf;">"default_board_setting"</span>: {
        <span style="color: #00afaf;">"default_male_board"</span>: 1,
        <span style="color: #00afaf;">"default_female_board"</span>: 0
    },
    <span style="color: #00afaf;">"need_promote_status"</span>: 1,
    <span style="color: #00afaf;">"need_anchor_knights_board"</span>: 1,
    <span style="color: #00afaf;">"promote_event_type"</span>: 1,
    <span style="color: #00afaf;">"gifts_setting"</span>: {}
}
</pre>
</div>

<p>
男榜、女榜<br>
</p>
<div class="org-src-container">
<pre class="src src-js">{
    <span style="color: #00afaf;">"auto_register"</span>: 0,
    <span style="color: #00afaf;">"board_setting"</span>: {
        <span style="color: #00afaf;">"valid_list"</span>: [0, 1]
    },
    <span style="color: #00afaf;">"default_board_setting"</span>: {
        <span style="color: #00afaf;">"default_male_board"</span>: 1,
        <span style="color: #00afaf;">"default_female_board"</span>: 0
    },
    <span style="color: #00afaf;">"need_promote_status"</span>: 1,
    <span style="color: #00afaf;">"need_anchor_knights_board"</span>: 1,
    <span style="color: #00afaf;">"promote_event_type"</span>: 1,
    <span style="color: #00afaf;">"gifts_setting"</span>: {}
}
</pre>
</div>

<!-- This HTML table template is generated by emacs 27.2 -->
<table border="1">
  <tr>
    <td align="left" valign="top">
      &nbsp;uid&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;screen_name&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;gender&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;display_id&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;ctime&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
  </tr>
  <tr>
    <td align="left" valign="top">
      &nbsp;u2572271555577408120001317&nbsp;<br />
      &nbsp;u4361101562832368120001324&nbsp;<br />
      &nbsp;u4605521547039481120001298&nbsp;<br />
      &nbsp;u8029551547033664120001360&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;shi_zhonghe&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;qianye&nbsp;lin&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;腻腻腻腻酱&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />
      &nbsp;王广宇&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;1&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;2&nbsp;<br />
      &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;&nbsp;770955577&nbsp;<br />
      &nbsp;&nbsp;776062832&nbsp;<br />
      &nbsp;&nbsp;765047039&nbsp;<br />
      &nbsp;&nbsp;764947033&nbsp;
    </td>
    <td align="left" valign="top">
      &nbsp;2019-04-18&nbsp;08:50:09&nbsp;<br />
      &nbsp;2019-07-11&nbsp;08:06:08&nbsp;<br />
      &nbsp;2019-01-09&nbsp;13:11:21&nbsp;<br />
      &nbsp;2019-01-09&nbsp;11:34:25&nbsp;
    </td>
  </tr>
</table>
</div>
</div>

<div id="outline-container-org28ff4ec" class="outline-3">
<h3 id="org28ff4ec"><span class="section-number-3">2.2</span> round2 活动配置：新人男榜、新人女榜配置一个日榜类型的 rich_anchor 活动 round2_A；男榜、女榜配置一个日榜类型的 rich_anchor 活动 round2_B</h3>
<div class="outline-text-3" id="text-2-2">
<p>
新人男榜、新人女榜<br>
</p>
<div class="org-src-container">
<pre class="src src-js">{
    <span style="color: #00afaf;">"auto_register"</span>: 0,
    <span style="color: #00afaf;">"daily"</span>: 1,
    <span style="color: #00afaf;">"daily_buff"</span>: [1.2, 1.1],
    <span style="color: #00afaf;">"need_promote_status"</span>: 1,
    <span style="color: #00afaf;">"promote_event_type"</span>: 1,
    <span style="color: #00afaf;">"need_anchor_knights_board"</span>: 1,
    <span style="color: #00afaf;">"board_setting"</span>: {
        <span style="color: #00afaf;">"valid_list"</span>: [0, 1]
    },
    <span style="color: #00afaf;">"gifts_setting"</span>: {}
}
</pre>
</div>

<p>
男榜、女榜<br>
</p>
<div class="org-src-container">
<pre class="src src-js">{
    <span style="color: #00afaf;">"auto_register"</span>: 0,
    <span style="color: #00afaf;">"daily"</span>: 1,
    <span style="color: #00afaf;">"daily_buff"</span>: [1.2, 1.1],
    <span style="color: #00afaf;">"promote_event_type"</span>: 1,
    <span style="color: #00afaf;">"need_anchor_knights_board"</span>: 1,
    <span style="color: #00afaf;">"board_setting"</span>: {
        <span style="color: #00afaf;">"valid_list"</span>: [0, 1]
    },
    <span style="color: #00afaf;">"gifts_setting"</span>: {}
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org9aa1d0a" class="outline-3">
<h3 id="org9aa1d0a"><span class="section-number-3">2.3</span> rich_anchor 添加日榜概念：日榜 rich_anchor 活动，在活动期间每天都有一个日榜榜单、和一个总榜榜单。日榜实时计算，总榜非实时计算，日榜和总榜对应有加成关系</h3>
</div>
<div id="outline-container-orgc6d4151" class="outline-3">
<h3 id="orgc6d4151"><span class="section-number-3">2.4</span> 日榜晋级：round1_A 晋级到 round2_A 总榜后，还需要晋级到 round2_A 的每一个日榜</h3>
<div class="outline-text-3" id="text-2-4">
<div class="org-src-container">
<pre class="src src-js">[
    {
        <span style="color: #00afaf;">"promote_type"</span>: <span style="color: #00afaf;">"daily"</span>,
        <span style="color: #00afaf;">"from_event"</span>: <span style="color: #00afaf;">"yc2019_round1_1_new"</span>,
        <span style="color: #00afaf;">"to_event"</span>: <span style="color: #00afaf;">"yc2019_round1_2_new"</span>,
        <span style="color: #00afaf;">"from_board"</span>: [0, 1],
        <span style="color: #00afaf;">"to_board"</span>: [0, 1],
        <span style="color: #00afaf;">"promote_status"</span>: 1,
        <span style="color: #00afaf;">"count"</span>: [30, 30]
    },
    {
        <span style="color: #00afaf;">"promote_type"</span>: <span style="color: #00afaf;">"daily"</span>,
        <span style="color: #00afaf;">"from_event"</span>: <span style="color: #00afaf;">"yc2019_round1_1_all"</span>,
        <span style="color: #00afaf;">"to_event"</span>: <span style="color: #00afaf;">"yc2019_round1_2_all"</span>,
        <span style="color: #00afaf;">"from_board"</span>: [0, 1],
        <span style="color: #00afaf;">"to_board"</span>: [0, 1],
        <span style="color: #00afaf;">"promote_status"</span>: 1,
        <span style="color: #00afaf;">"count"</span>: [30, 30]
    }
]
</pre>
</div>
</div>
</div>
<div id="outline-container-org64ae889" class="outline-3">
<h3 id="org64ae889"><span class="section-number-3">2.5</span> promote 接口调整：判断一个 rich_anchor 活动如果是日榜类型的话，在 master 中自动生成昨日日榜和今日日榜 event_name、board 等，start_time、end_time 为日榜当天的开始时间、结束时间</h3>
</div>
<div id="outline-container-orgedb5bd1" class="outline-3">
<h3 id="orgedb5bd1"><span class="section-number-3">2.6</span> 新增一个定时任务：每天执行一次，把日榜加算到总榜中，需要考虑 board</h3>
</div>
</div>

<div id="outline-container-org57e6453" class="outline-2">
<h2 id="org57e6453"><span class="section-number-2">3</span> 第三阶段代码实现</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org90f0eaa" class="outline-3">
<h3 id="org90f0eaa"><span class="section-number-3">3.1</span> <span class="done DONE">DONE</span> round1 家族对战配置</h3>
<div class="outline-text-3" id="text-3-1">
<p>
添加吸金主播配置<br>
</p>
<div class="org-src-container">
<pre class="src src-js">{
    <span style="color: #00afaf;">"auto_register"</span>: 0,
    <span style="color: #00afaf;">"gifts_setting"</span>: {
        <span style="color: #00afaf;">"256"</span>: 0
    },
    <span style="color: #00afaf;">"need_promote_status"</span>: 1,
    <span style="color: #00afaf;">"need_anchor_knights_board"</span>: 0,
    <span style="color: #00afaf;">"promote_event_type"</span>: 1
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org8e50fec" class="outline-3">
<h3 id="org8e50fec"><span class="section-number-3">3.2</span> <span class="done DONE">DONE</span> 1-&gt;2晋级赛定时任务：分数完全继承</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">
<pre class="src src-js">[
    {
        <span style="color: #00afaf;">"promote_type"</span>: <span style="color: #00afaf;">"daily"</span>,
        <span style="color: #00afaf;">"from_event"</span>: <span style="color: #00afaf;">"yc2019_round3_1"</span>,
        <span style="color: #00afaf;">"to_event"</span>: <span style="color: #00afaf;">"yc2019_round3_2"</span>,
        <span style="color: #00afaf;">"from_board"</span>: [0],
        <span style="color: #00afaf;">"to_board"</span>: [0],
        <span style="color: #00afaf;">"promote_status"</span>: 1,
        <span style="color: #00afaf;">"count"</span>: [40],
        <span style="color: #00afaf;">"inherit_buff"</span>: [1]
    },
    {
        <span style="color: #00afaf;">"promote_type"</span>: <span style="color: #00afaf;">"normal"</span>,
        <span style="color: #00afaf;">"from_event"</span>: <span style="color: #00afaf;">"yc2019_round3_2"</span>,
        <span style="color: #00afaf;">"to_event"</span>: <span style="color: #00afaf;">"yc2019_round3_3"</span>,
        <span style="color: #00afaf;">"from_board"</span>: [0],
        <span style="color: #00afaf;">"to_board"</span>: [0],
        <span style="color: #00afaf;">"promote_status"</span>: 1,
        <span style="color: #00afaf;">"count"</span>: [20],
        <span style="color: #00afaf;">"inherit_buff"</span>: [0.3, 0.25, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.2, 0.15]
    }
]
</pre>
</div>
</div>
</div>
<div id="outline-container-orga908924" class="outline-3">
<h3 id="orga908924"><span class="section-number-3">3.3</span> <span class="done DONE">DONE</span> 2-&gt;3晋级赛定时任务：吸金主播晋级到日榜时，需要分数按比例继承到下一阶段</h3>
</div>
<div id="outline-container-org319b9f7" class="outline-3">
<h3 id="org319b9f7"><span class="section-number-3">3.4</span> <span class="done DONE">DONE</span> 晋级赛接口：调整今日榜、昨日榜返回的位置</h3>
</div>
<div id="outline-container-orgc2a6784" class="outline-3">
<h3 id="orgc2a6784"><span class="section-number-3">3.5</span> <span class="done DONE">DONE</span> 日榜结算时，没有配置 valid_list 时，默认 board 使用 0</h3>
</div>
<div id="outline-container-org63b9573" class="outline-3">
<h3 id="org63b9573"><span class="section-number-3">3.6</span> <span class="done DONE">DONE</span> family_battle 送礼加分时，取 topk 用户，其它用户不进行加分；</h3>
</div>
<div id="outline-container-org524ed56" class="outline-3">
<h3 id="org524ed56"><span class="section-number-3">3.7</span> <span class="done DONE">DONE</span> family_battle 结算时，根据指定加分规则，加分到吸金主播榜单中。</h3>
</div>
<div id="outline-container-org6cdd455" class="outline-3">
<h3 id="org6cdd455"><span class="section-number-3">3.8</span> <span class="done DONE">DONE</span> 第三阶段返回总榜，接口增加一个参数来返回总榜的数据</h3>
</div>
<div id="outline-container-orgf943396" class="outline-3">
<h3 id="orgf943396"><span class="section-number-3">3.9</span> <span class="done DONE">DONE</span> 小时榜直播间弹窗，获取总榜直播间弹窗</h3>
</div>
<div id="outline-container-org81fe4d9" class="outline-3">
<h3 id="org81fe4d9"><span class="section-number-3">3.10</span> <span class="done DONE">DONE</span> 小时榜骑士榜，获取总榜骑士榜</h3>
</div>
<div id="outline-container-orge0c93ef" class="outline-3">
<h3 id="orge0c93ef"><span class="section-number-3">3.11</span> <span class="done DONE">DONE</span> 注意：第一个小阶段不要忘记提交代码时添加 topk 用户</h3>
</div>
<div id="outline-container-orgf5c7347" class="outline-3">
<h3 id="orgf5c7347"><span class="section-number-3">3.12</span> <span class="done DONE">DONE</span> 注意：需要对晋级到 yc2019_round3_1 的主播执行晋级操作，否则会加榜单失败</h3>
<div class="outline-text-3" id="text-3-12">
<div class="org-src-container">
<pre class="src src-python">events_cacher_v2.register_rich_anchor_contestant(<span style="color: #00afaf;">"yc2019_round3_1"</span>, <span style="color: #00afaf;">"u8960471526891737110001220"</span>, 0)
events_cacher_v2.register_rich_anchor_contestant(<span style="color: #00afaf;">"yc2019_round3_1"</span>, <span style="color: #00afaf;">"u2572271555577408120001317"</span>, 0)
events_cacher_v2.register_rich_anchor_contestant(<span style="color: #00afaf;">"yc2019_round3_1"</span>, <span style="color: #00afaf;">"u4778031560328976120001306"</span>, 0)
events_cacher_v2.register_rich_anchor_contestant(<span style="color: #00afaf;">"yc2019_round3_1"</span>, <span style="color: #00afaf;">"u9250061480925911020001233"</span>, 0)
events_cacher_v2.register_rich_anchor_contestant(<span style="color: #00afaf;">"yc2019_round3_1"</span>, <span style="color: #00afaf;">"u5075561559294511120001299"</span>, 0)
events_cacher_v2.sign_anchor_status(<span style="color: #00afaf;">"yc2019_round1_1_all"</span>, <span style="color: #00afaf;">"xxx"</span>, 1)
</pre>
</div>
</div>
</div>

<div id="outline-container-org55231a1" class="outline-3">
<h3 id="org55231a1"><span class="section-number-3">3.13</span> <span class="done DONE">DONE</span> 注意：小时榜有礼物数量限制，是否调整，调整</h3>
</div>
<div id="outline-container-org8eea8d7" class="outline-3">
<h3 id="org8eea8d7"><span class="section-number-3">3.14</span> <span class="done DONE">DONE</span> 注意：直播间弹窗 end_time 是 2.6 转盘的需求</h3>
</div>
<div id="outline-container-orgbcb2fe5" class="outline-3">
<h3 id="orgbcb2fe5"><span class="section-number-3">3.15</span> <span class="done DONE">DONE</span> 额外：第二阶段中每日送礼限制应该和 event_name 绑定在一起</h3>
</div>
<div id="outline-container-org2f58da6" class="outline-3">
<h3 id="org2f58da6"><span class="section-number-3">3.16</span> <span class="todo TODO">TODO</span> 小时榜是否和转盘二期小时榜需求有冲突</h3>
</div>
<div id="outline-container-org9a2b760" class="outline-3">
<h3 id="org9a2b760"><span class="section-number-3">3.17</span> <span class="done DONE">DONE</span> 清理之前写死的无用代码。events 吸金主播、吸金主播骑士榜已清理。评论指定文案加分，注释掉</h3>
</div>
</div>

<div id="outline-container-org456a492" class="outline-2">
<h2 id="org456a492"><span class="section-number-2">4</span> 第三阶段重启服务</h2>
<div class="outline-text-2" id="text-4">
<ul class="org-ul">
<li>http<br></li>
<li>important-events<br></li>
<li>very-important-events<br></li>
<li>schedule-event<br></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p>本笔记系统由
    <a href="">时中贺</a> 搭建和维护，使用
    <a href="https://www.gnu.org/software/emacs/">Emacs</a>
    <a href="http://orgmode.org/">Org mode</a> 编辑和构建
    <br />
    email: shi_zhonghe@163.com
</p>
<script src="file:/Users/he/notes/html/css/jquery-2.1.3.min.js"></script>
<script src="file:/Users/he/notes/html/css/main.js"></script>
</div>
</body>
</html>
