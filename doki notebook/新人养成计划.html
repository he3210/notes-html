<!DOCTYPE html>
<html lang="zh-CN">
<head>
<!-- 2021-05-06 Thu 15:26 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>&lrm;</title>
<meta name="generator" content="Org mode">
<meta name="author" content="时中贺">
<link rel="stylesheet" type="text/css" href="file:/Users/he/notes/html/css/style.css" />
<link rel="shortcut icon" href="file:/Users/he/notes/html/images/favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="preamble" class="status">
<div id="navbar">
    <ul>
        <li id="site-master"><a href="file:/Users/he/notes/html/index.html">浪的不轻</a></li>
        <li><a class="navbar-item" href="file:/Users/he/notes/html/gallery.html">Gallery</a> </li>
        <li><a class="navbar-item" href="file:/Users/he/notes/html/notebooks.html">Notebooks</a> </li>
        <li><a class="navbar-item" href="file:/Users/he/notes/html/links.html">Links</a> </li>
        <li><a class="navbar-item" href="file:/Users/he/notes/html/about.html">About</a> </li>
        <li class="search">
            <form action="http://google.com/search" method="get" accept-charset="utf-8">
                <input type="search" id="search" name="q" autocomplete="off" maxlength="30" placeholder="Google..">
                <input type="hidden" name="q" value="site:www.langdebuqing.com">
            </form>
        </li>
    </ul>
</div>
</div>
<div id="content">
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgc6941b8">1. 需求</a>
<ul>
<li><a href="#org80426fd">1.1. 所有新人参加该活动。且新人不能参加任何其它活动（这块改动太大）</a></li>
<li><a href="#orgf916d64">1.2. 水滴、肥料</a>
<ul>
<li><a href="#orgc0c0a0b">1.2.1. 主播开播时长、被评论数、被关注数获得水滴；</a></li>
<li><a href="#org5fd05ff">1.2.2. 观众在新人直播间达成观看时长，直接给主播加水滴，直接给观众加水晶，间接给观众加肥料（需到h5领取肥料）</a></li>
</ul>
</li>
<li><a href="#orga0b272b">1.3. 树苗、小树直播间不能送肥料？可以送</a></li>
<li><a href="#org8c4ae00">1.4. 用户必须调用新人接口才会绑定 udid，会导致没调用接口的用户无法绑定，收不到水晶</a></li>
</ul>
</li>
<li><a href="#org5ac780e">2. 数据结构</a>
<ul>
<li><a href="#orgc3900aa">2.1. redis</a>
<ul>
<li><a href="#orgec988cf">2.1.1. 水晶 key: pre + uid + rank_name</a></li>
<li><a href="#org6ff37ec">2.1.2. 每日任务 hash key: pre + uid + date</a></li>
</ul>
</li>
<li><a href="#org9e20795">2.2. sql</a>
<ul>
<li><a href="#org01d45aa">2.2.1. 毕业生表</a></li>
<li><a href="#org306f616">2.2.2. 奖励历史表</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgb880ff7">3. 开发内容 共10d</a>
<ul>
<li><a href="#org4bd3749">3.1. 低层设计、接口文档 1d</a></li>
<li><a href="#orgc259607">3.2. <span class="done DONE">DONE</span> http 接口 共3.5d</a>
<ul>
<li><a href="#orgf271734">3.2.1. 兑换所接口 1.5d</a></li>
<li><a href="#orgc3f4181">3.2.2. 新人主播推荐接口 0.5d</a></li>
<li><a href="#org89da49b">3.2.3. 本周新人活动排行榜 0.5d</a></li>
<li><a href="#orga2f3113">3.2.4. 往期新人活动top3  0.5d</a></li>
<li><a href="#orgcb3fac6">3.2.5. 直播间弹窗 主播/观众任务领取页面 0.5d</a></li>
</ul>
</li>
<li><a href="#orge4d389c">3.3. <span class="done DONE">DONE</span> 浮动icon/同步icon 0.5d</a></li>
<li><a href="#org7e14ff3">3.4. <span class="done DONE">DONE</span> 加分模块 1.5d</a></li>
<li><a href="#org86641c7">3.5. <span class="done DONE">DONE</span> 定时结算 1d</a></li>
<li><a href="#org96811a0">3.6. <span class="done DONE">DONE</span> 新手直播间屏蔽其它活动（棒球、家族对战、自动报名类活动等） 0.5d</a></li>
<li><a href="#org589170a">3.7. <span class="done DONE">DONE</span> 观看时长、开播时长2个新异步任务，评论、关注、开播异步任务 2d</a></li>
<li><a href="#org80af5d6">3.8. <span class="done DONE">DONE</span> 活动初始化。活动开始时，遍历所有直播，加入到吸金榜单中</a></li>
<li><a href="#org57a04d9">3.9. <span class="done DONE">DONE</span> 设备绑定。在进房接口绑定 uid 和 udid。</a></li>
</ul>
</li>
<li><a href="#org58c9a40">4. 重启服务</a></li>
</ul>
</div>
</div>
<p>
+TITLE: 新人养成计划<br>
</p>

<div id="outline-container-orgc6941b8" class="outline-2">
<h2 id="orgc6941b8"><span class="section-number-2">1</span> 需求</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org80426fd" class="outline-3">
<h3 id="org80426fd"><span class="section-number-3">1.1</span> 所有新人参加该活动。且新人不能参加任何其它活动（这块改动太大）</h3>
</div>
<div id="outline-container-orgf916d64" class="outline-3">
<h3 id="orgf916d64"><span class="section-number-3">1.2</span> 水滴、肥料</h3>
<div class="outline-text-3" id="text-1-2">
</div>
<div id="outline-container-orgc0c0a0b" class="outline-4">
<h4 id="orgc0c0a0b"><span class="section-number-4">1.2.1</span> 主播开播时长、被评论数、被关注数获得水滴；</h4>
</div>
<div id="outline-container-org5fd05ff" class="outline-4">
<h4 id="org5fd05ff"><span class="section-number-4">1.2.2</span> 观众在新人直播间达成观看时长，直接给主播加水滴，直接给观众加水晶，间接给观众加肥料（需到h5领取肥料）</h4>
</div>
</div>

<div id="outline-container-orga0b272b" class="outline-3">
<h3 id="orga0b272b"><span class="section-number-3">1.3</span> 树苗、小树直播间不能送肥料？可以送</h3>
</div>

<div id="outline-container-org8c4ae00" class="outline-3">
<h3 id="org8c4ae00"><span class="section-number-3">1.4</span> 用户必须调用新人接口才会绑定 udid，会导致没调用接口的用户无法绑定，收不到水晶</h3>
</div>
</div>
<div id="outline-container-org5ac780e" class="outline-2">
<h2 id="org5ac780e"><span class="section-number-2">2</span> 数据结构</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orgc3900aa" class="outline-3">
<h3 id="orgc3900aa"><span class="section-number-3">2.1</span> redis</h3>
<div class="outline-text-3" id="text-2-1">
</div>
<div id="outline-container-orgec988cf" class="outline-4">
<h4 id="orgec988cf"><span class="section-number-4">2.1.1</span> 水晶 key: pre + uid + rank_name</h4>
<div class="outline-text-4" id="text-2-1-1">
<p>
crystal_total         总水晶数量<br>
crystal_used          消费过的水晶数量<br>
</p>
</div>
</div>

<div id="outline-container-org6ff37ec" class="outline-4">
<h4 id="org6ff37ec"><span class="section-number-4">2.1.2</span> 每日任务 hash key: pre + uid + date</h4>
<div class="outline-text-4" id="text-2-1-2">
<p>
问题：如何删除该 key?<br>
field:value<br>
show_time             开播时长<br>
commented_times       被评论次数<br>
followed_times        被关注次数<br>
view_time             观看时长<br>
comment_times         评论次数<br>
follow_times          关注次数。最多10次<br>
send_credits          送礼数<br>
"follow:%s" % uid     关注的人<br>
</p>

<p>
anchor_show_task:index          主播开播时长任务:已领取的奖励的下标<br>
anchor_commented_task:index     主播被评论次数任务:已领取的奖励的下标<br>
anchor_followed_task:index      主播被关注次数任务:已领取的奖励的下标<br>
</p>

<p>
audience_pt_task:index          观众送礼任务:已领取的奖励的下标<br>
audience_super_task             观众超级任务<br>
</p>
</div>
</div>
</div>

<div id="outline-container-org9e20795" class="outline-3">
<h3 id="org9e20795"><span class="section-number-3">2.2</span> sql</h3>
<div class="outline-text-3" id="text-2-2">
</div>
<div id="outline-container-org01d45aa" class="outline-4">
<h4 id="org01d45aa"><span class="section-number-4">2.2.1</span> 毕业生表</h4>
<div class="outline-text-4" id="text-2-2-1">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #5f8700;">CREATE</span> <span style="color: #5f8700;">TABLE</span> `new_anchor_graduate_history` (
`id` <span style="color: #af8700;">int</span>(10) unsigned <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> AUTO_INCREMENT,
`event_name` <span style="color: #af8700;">varchar</span>(64) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> COMMENT <span style="color: #00afaf;">'&#27963;&#21160;&#21517;'</span>,
`rank_name` <span style="color: #af8700;">varchar</span>(64) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> COMMENT <span style="color: #00afaf;">'&#20174;&#21560;&#37329;&#20027;&#25773;&#30340;&#21738;&#20010;&#27036;&#21333;&#21517;&#27605;&#19994;&#30340;'</span>,
`uid` <span style="color: #af8700;">varchar</span>(64) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> COMMENT <span style="color: #00afaf;">'anchor uid'</span>,
`score` <span style="color: #af8700;">int</span>(11) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'0'</span> COMMENT <span style="color: #00afaf;">'&#27605;&#19994;&#26102;&#30340;&#20998;&#25968;'</span>,
`rank` <span style="color: #af8700;">int</span>(10) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'0'</span> COMMENT <span style="color: #00afaf;">'&#27605;&#19994;&#26102;&#30340;&#25490;&#21517;&#65292;&#20174; 0 &#24320;&#22987;'</span>,
`ctime` datetime <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span>,
`mtime` <span style="color: #af8700;">timestamp</span> <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #5f8700;">CURRENT_TIMESTAMP</span> <span style="color: #5f8700;">ON</span> <span style="color: #5f8700;">UPDATE</span> <span style="color: #5f8700;">CURRENT_TIMESTAMP</span>,
<span style="color: #5f8700;">PRIMARY</span> <span style="color: #5f8700;">KEY</span> (`id`),
<span style="color: #5f8700;">UNIQUE</span> <span style="color: #5f8700;">KEY</span> `uk_event_name_uid` (`event_name`, `uid`),
<span style="color: #5f8700;">KEY</span> `idx_rank_name` (`rank_name`)
) ENGINE = InnoDB AUTO_INCREMENT = 1 <span style="color: #5f8700;">DEFAULT</span> CHARSET = utf8mb4;
</pre>
</div>
</div>
</div>

<div id="outline-container-org306f616" class="outline-4">
<h4 id="org306f616"><span class="section-number-4">2.2.2</span> 奖励历史表</h4>
<div class="outline-text-4" id="text-2-2-2">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #5f8700;">CREATE</span> <span style="color: #5f8700;">TABLE</span> `new_anchor_reward_history` (
`id` <span style="color: #af8700;">int</span>(10) unsigned <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> AUTO_INCREMENT,
`event_name` <span style="color: #af8700;">varchar</span>(40) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> COMMENT <span style="color: #00afaf;">'&#27963;&#21160;&#21517;'</span>,
`rank_name` <span style="color: #af8700;">varchar</span>(40) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> COMMENT <span style="color: #00afaf;">'&#27036;&#21333;&#21517;'</span>,
`reason` <span style="color: #af8700;">varchar</span>(32) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">''</span> COMMENT <span style="color: #00afaf;">'&#33719;&#22870;&#21407;&#22240;&#12290;comment-&#35780;&#35770; commented-&#34987;&#35780;&#35770; follow-&#20851;&#27880; followed-&#34987;&#20851;&#27880; view_time-&#35266;&#30475;&#26102;&#38271; show_time-&#30452;&#25773;&#26102;&#38271; get-&#20027;&#21160;&#39046;&#21462;'</span>,
`uid` <span style="color: #af8700;">varchar</span>(32) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">''</span> COMMENT <span style="color: #00afaf;">'&#36129;&#29486;&#32773;'</span>,
`t_uid` <span style="color: #af8700;">varchar</span>(32) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">''</span> COMMENT <span style="color: #00afaf;">'&#33719;&#22870;&#32773;'</span>,
`reward_name` <span style="color: #af8700;">int</span>(11) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'0'</span> COMMENT <span style="color: #00afaf;">'&#22870;&#21697;&#21517;&#12290;drip-&#27700;&#28404; crystal-&#27700;&#26230; fertilizer-&#21270;&#32933;'</span>,
`cnt` <span style="color: #af8700;">int</span>(10) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'0'</span> COMMENT <span style="color: #00afaf;">'&#22870;&#21697;&#25968;&#37327;'</span>,
`extra` <span style="color: #af8700;">varchar</span>(128) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'{}'</span> COMMENT <span style="color: #00afaf;">'&#39069;&#22806;&#25968;&#25454;'</span>,
`ctime` datetime <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span>,
`mtime` <span style="color: #af8700;">timestamp</span> <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #5f8700;">CURRENT_TIMESTAMP</span> <span style="color: #5f8700;">ON</span> <span style="color: #5f8700;">UPDATE</span> <span style="color: #5f8700;">CURRENT_TIMESTAMP</span>,
<span style="color: #5f8700;">PRIMARY</span> <span style="color: #5f8700;">KEY</span> (`id`),
<span style="color: #5f8700;">KEY</span> `idx_t_uid_rank_name` (`t_uid`, `rank_name`)
) ENGINE = InnoDB <span style="color: #5f8700;">DEFAULT</span> CHARSET = utf8mb4;
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="outline-container-orgb880ff7" class="outline-2">
<h2 id="orgb880ff7"><span class="section-number-2">3</span> 开发内容 共10d</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org4bd3749" class="outline-3">
<h3 id="org4bd3749"><span class="section-number-3">3.1</span> 低层设计、接口文档 1d</h3>
</div>
<div id="outline-container-orgc259607" class="outline-3">
<h3 id="orgc259607"><span class="section-number-3">3.2</span> <span class="done DONE">DONE</span> http 接口 共3.5d</h3>
<div class="outline-text-3" id="text-3-2">
</div>
<div id="outline-container-orgf271734" class="outline-4">
<h4 id="orgf271734"><span class="section-number-4">3.2.1</span> 兑换所接口 1.5d</h4>
<div class="outline-text-4" id="text-3-2-1">
<ul class="org-ul">
<li>GET + POST<br></li>
<li>用水晶兑换、观众任务兑换、主播任务兑换<br></li>
</ul>
</div>
</div>
<div id="outline-container-orgc3f4181" class="outline-4">
<h4 id="orgc3f4181"><span class="section-number-4">3.2.2</span> 新人主播推荐接口 0.5d</h4>
<div class="outline-text-4" id="text-3-2-2">
<ul class="org-ul">
<li>GET<br></li>
</ul>
</div>
</div>
<div id="outline-container-org89da49b" class="outline-4">
<h4 id="org89da49b"><span class="section-number-4">3.2.3</span> 本周新人活动排行榜 0.5d</h4>
<div class="outline-text-4" id="text-3-2-3">
<ul class="org-ul">
<li>GET<br></li>
</ul>
</div>
</div>
<div id="outline-container-orga2f3113" class="outline-4">
<h4 id="orga2f3113"><span class="section-number-4">3.2.4</span> 往期新人活动top3  0.5d</h4>
</div>
<div id="outline-container-orgcb3fac6" class="outline-4">
<h4 id="orgcb3fac6"><span class="section-number-4">3.2.5</span> 直播间弹窗 主播/观众任务领取页面 0.5d</h4>
</div>
</div>
<div id="outline-container-orge4d389c" class="outline-3">
<h3 id="orge4d389c"><span class="section-number-3">3.3</span> <span class="done DONE">DONE</span> 浮动icon/同步icon 0.5d</h3>
</div>
<div id="outline-container-org7e14ff3" class="outline-3">
<h3 id="org7e14ff3"><span class="section-number-3">3.4</span> <span class="done DONE">DONE</span> 加分模块 1.5d</h3>
</div>
<div id="outline-container-org86641c7" class="outline-3">
<h3 id="org86641c7"><span class="section-number-3">3.5</span> <span class="done DONE">DONE</span> 定时结算 1d</h3>
</div>
<div id="outline-container-org96811a0" class="outline-3">
<h3 id="org96811a0"><span class="section-number-3">3.6</span> <span class="done DONE">DONE</span> 新手直播间屏蔽其它活动（棒球、家族对战、自动报名类活动等） 0.5d</h3>
</div>
<div id="outline-container-org589170a" class="outline-3">
<h3 id="org589170a"><span class="section-number-3">3.7</span> <span class="done DONE">DONE</span> 观看时长、开播时长2个新异步任务，评论、关注、开播异步任务 2d</h3>
</div>
<div id="outline-container-org80af5d6" class="outline-3">
<h3 id="org80af5d6"><span class="section-number-3">3.8</span> <span class="done DONE">DONE</span> 活动初始化。活动开始时，遍历所有直播，加入到吸金榜单中</h3>
</div>
<div id="outline-container-org57a04d9" class="outline-3">
<h3 id="org57a04d9"><span class="section-number-3">3.9</span> <span class="done DONE">DONE</span> 设备绑定。在进房接口绑定 uid 和 udid。</h3>
</div>
</div>

<div id="outline-container-org58c9a40" class="outline-2">
<h2 id="org58c9a40"><span class="section-number-2">4</span> 重启服务</h2>
<div class="outline-text-2" id="text-4">
<ul class="org-ul">
<li>http<br></li>
<li>schedule-event<br></li>
<li>schedule-event2<br></li>
<li>task_v2-important<br></li>
<li>events-important 吸金主播活动屏蔽新人<br></li>
<li>admin<br></li>
</ul>
</div>
</div>
</div>
<div id="postamble" class="status">
<p>本笔记系统由
    <a href="">时中贺</a> 搭建和维护，使用
    <a href="https://www.gnu.org/software/emacs/">Emacs</a>
    <a href="http://orgmode.org/">Org mode</a> 编辑和构建
    <br />
    email: shi_zhonghe@163.com
</p>
<script src="file:/Users/he/notes/html/css/jquery-2.1.3.min.js"></script>
<script src="file:/Users/he/notes/html/css/main.js"></script>
</div>
</body>
</html>
