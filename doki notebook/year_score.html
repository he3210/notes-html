<!DOCTYPE html>
<html lang="zh-CN">
<head>
<!-- 2021-05-06 Thu 15:27 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>年度积分</title>
<meta name="generator" content="Org mode">
<meta name="author" content="时中贺">
<link rel="stylesheet" type="text/css" href="file:/Users/he/notes/html/css/style.css" />
<link rel="shortcut icon" href="file:/Users/he/notes/html/images/favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="preamble" class="status">
<div id="navbar">
    <ul>
        <li id="site-master"><a href="file:/Users/he/notes/html/index.html">浪的不轻</a></li>
        <li><a class="navbar-item" href="file:/Users/he/notes/html/gallery.html">Gallery</a> </li>
        <li><a class="navbar-item" href="file:/Users/he/notes/html/notebooks.html">Notebooks</a> </li>
        <li><a class="navbar-item" href="file:/Users/he/notes/html/links.html">Links</a> </li>
        <li><a class="navbar-item" href="file:/Users/he/notes/html/about.html">About</a> </li>
        <li class="search">
            <form action="http://google.com/search" method="get" accept-charset="utf-8">
                <input type="search" id="search" name="q" autocomplete="off" maxlength="30" placeholder="Google..">
                <input type="hidden" name="q" value="site:www.langdebuqing.com">
            </form>
        </li>
    </ul>
</div>
</div>
<div id="content">
<h1 class="title">年度积分</h1>
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgb133ed4">1. 需求</a>
<ul>
<li><a href="#orgc0e54b4">1.1. 直播间入口</a>
<ul>
<li><a href="#orgb64f9f2">1.1.1. 主播头像、昵称、年度积分总排名、年度总积分</a></li>
<li><a href="#orgcbf4945">1.1.2. 正在参加的活动</a>
<ul>
<li><a href="#org8e3fca6">1.1.2.1. banner 图片。怎么获取图片？不能使用表 banner 中的图片等东西。因为 banners 表中没有 event_name 字段</a></li>
<li><a href="#orgedcb676">1.1.2.2. 拼接活动起止时间字段：开始时间-结束时间</a></li>
<li><a href="#orgdf43cc3">1.1.2.3. 当前排名</a></li>
<li><a href="#org92cad30">1.1.2.4. 活动的展示</a></li>
</ul>
</li>
<li><a href="#org624bd2e">1.1.3. 历史战绩</a>
<ul>
<li><a href="#org4c430d1">1.1.3.1. 单个活动</a></li>
<li><a href="#orgfb29643">1.1.3.2. 历史活动如何排序？按活动开始时间排序？按活动结束时间倒序</a></li>
<li><a href="#org65b3e94">1.1.3.3. 是否有分页？</a></li>
<li><a href="#org2684daa">1.1.3.4. 展示在历史战绩的活动有哪些？</a></li>
</ul>
</li>
<li><a href="#org07b5043">1.1.4. 该主播在某个活动的排名？</a></li>
<li><a href="#orgad2fb38">1.1.5. 是否要有分页</a></li>
</ul>
</li>
<li><a href="#org507b5c0">1.2. H5 展示</a>
<ul>
<li><a href="#org2f0f80f">1.2.1. 即将开始的活动</a>
<ul>
<li><a href="#org7bf8749">1.2.1.1. banner 图</a></li>
<li><a href="#orgfb3c2c5">1.2.1.2. auto_register 字段</a></li>
<li><a href="#org5bb1755">1.2.1.3. 拼接活动起止时间字段：开始时间-结束时间</a></li>
<li><a href="#org6cc4000">1.2.1.4. 家族积分奖励是什么？该活动 top1 计算得到的本活动年度积分</a></li>
</ul>
</li>
<li><a href="#org5550018">1.2.2. 活动系列一览</a>
<ul>
<li><a href="#orgcbf0246">1.2.2.1. 单个系列</a></li>
<li><a href="#org5867e84">1.2.2.2. 展示哪些活动系列</a></li>
<li><a href="#orgf679a7c">1.2.2.3. 系列排序</a></li>
<li><a href="#org45ac8fc">1.2.2.4. 系列名称、背景图片</a></li>
</ul>
</li>
<li><a href="#org82a23c4">1.2.3. H5 年度单个系列榜单</a>
<ul>
<li><a href="#org7a854fb">1.2.3.1. 主播在该系列排名、积分、用户信息。建议不要加“尚未参加活动”</a></li>
<li><a href="#org8f45d86">1.2.3.2. 榜单</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#org0629a17">2. 开发内容</a>
<ul>
<li><a href="#org0c5edf7">2.1. <span class="done DONE">DONE</span> 榜单</a>
<ul>
<li><a href="#org5effb15">2.1.1. 是否需要传递 room_id</a></li>
<li><a href="#org9140e63">2.1.2. 要有分页</a></li>
</ul>
</li>
<li><a href="#org83c4409">2.2. <span class="todo DOING">DOING</span> h5 展示接口</a>
<ul>
<li><a href="#orgbebb8ce">2.2.1. 分页如何做</a></li>
</ul>
</li>
<li><a href="#orgb5743c7">2.3. <span class="todo DOING">DOING</span> 年度积分接口</a></li>
<li><a href="#org29d587a">2.4. <span class="done DONE">DONE</span> 2 个运营后台</a></li>
<li><a href="#orgb38bfec">2.5. <span class="done DONE">DONE</span> 运营后台 2 个表的缓存，以及缓存更新</a></li>
<li><a href="#orgcea5340">2.6. <span class="todo DOING">DOING</span> 各种不同活动类型计算积分的算法，以及积分重算机制</a></li>
<li><a href="#org579717b">2.7. <span class="done DONE">DONE</span> schedule 每个 1 小时刷一次正在进行的活动积分</a></li>
<li><a href="#orga26e3a4">2.8. <span class="done DONE">DONE</span> 改造骑士榜</a></li>
<li><a href="#org210b0ea">2.9. <span class="todo DOING">DOING</span> 维护所有主播系列排名信息、系列得分；维护主播在所有活动的活动排名</a></li>
</ul>
</li>
<li><a href="#orgafbb62b">3. 上线注意事项 &amp;&amp; 注意事项</a>
<ul>
<li><a href="#org10b85e0">3.1. 建表</a></li>
<li><a href="#orge4b5ee8">3.2. series_to_event rules 运营配置</a></li>
<li><a href="#org07f8938">3.3. 重新计算积分</a>
<ul>
<li><a href="#org98a8ca6">3.3.1. 吸金主播只获取了榜单前 200 名进行重新计算积分</a></li>
<li><a href="#org59aaffd">3.3.2. common_rank 只获取了榜单前 200 名进行重新计算积分</a></li>
</ul>
</li>
<li><a href="#orgf598d66">3.4. rank_to_score 和 score_to_score 可同时生效</a></li>
<li><a href="#org3d2ba37">3.5. 涉及服务</a>
<ul>
<li><a href="#org986328d">3.5.1. http</a></li>
<li><a href="#org6cc3ed1">3.5.2. admin</a></li>
<li><a href="#org689cd28">3.5.3. schedule-event</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orgb133ed4" class="outline-2">
<h2 id="orgb133ed4"><span class="section-number-2">1</span> 需求</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-orgc0e54b4" class="outline-3">
<h3 id="orgc0e54b4"><span class="section-number-3">1.1</span> 直播间入口</h3>
<div class="outline-text-3" id="text-1-1">
</div>
<div id="outline-container-orgb64f9f2" class="outline-4">
<h4 id="orgb64f9f2"><span class="section-number-4">1.1.1</span> 主播头像、昵称、年度积分总排名、年度总积分</h4>
</div>
<div id="outline-container-orgcbf4945" class="outline-4">
<h4 id="orgcbf4945"><span class="section-number-4">1.1.2</span> 正在参加的活动</h4>
<div class="outline-text-4" id="text-1-1-2">
</div>
<div id="outline-container-org8e3fca6" class="outline-5">
<h5 id="org8e3fca6"><span class="section-number-5">1.1.2.1</span> banner 图片。怎么获取图片？不能使用表 banner 中的图片等东西。因为 banners 表中没有 event_name 字段</h5>
</div>
<div id="outline-container-orgedcb676" class="outline-5">
<h5 id="orgedcb676"><span class="section-number-5">1.1.2.2</span> 拼接活动起止时间字段：开始时间-结束时间</h5>
</div>
<div id="outline-container-orgdf43cc3" class="outline-5">
<h5 id="orgdf43cc3"><span class="section-number-5">1.1.2.3</span> 当前排名</h5>
</div>
<div id="outline-container-org92cad30" class="outline-5">
<h5 id="org92cad30"><span class="section-number-5">1.1.2.4</span> 活动的展示</h5>
<div class="outline-text-5" id="text-1-1-2-4">
</div>
<ol class="org-ol">
<li><a id="org8a387c4"></a>方案一：仅当主播在榜单中才展示该活动，不管榜单中的积分是否是 0<br></li>
<li><a id="org13d9c23"></a>方案二：根据 auto_register 字段和榜单来判断是否展示<br></li>
</ol>
</div>
</div>
<div id="outline-container-org624bd2e" class="outline-4">
<h4 id="org624bd2e"><span class="section-number-4">1.1.3</span> 历史战绩</h4>
<div class="outline-text-4" id="text-1-1-3">
</div>
<div id="outline-container-org4c430d1" class="outline-5">
<h5 id="org4c430d1"><span class="section-number-5">1.1.3.1</span> 单个活动</h5>
<div class="outline-text-5" id="text-1-1-3-1">
</div>
<ol class="org-ol">
<li><a id="orgbe9b863"></a>banner 图<br></li>
<li><a id="orgb92fb46"></a>活动排名<br></li>
<li><a id="org86b056d"></a>top3 knight<br></li>
</ol>
</div>
<div id="outline-container-orgfb29643" class="outline-5">
<h5 id="orgfb29643"><span class="section-number-5">1.1.3.2</span> 历史活动如何排序？按活动开始时间排序？按活动结束时间倒序</h5>
</div>
<div id="outline-container-org65b3e94" class="outline-5">
<h5 id="org65b3e94"><span class="section-number-5">1.1.3.3</span> 是否有分页？</h5>
</div>
<div id="outline-container-org2684daa" class="outline-5">
<h5 id="org2684daa"><span class="section-number-5">1.1.3.4</span> 展示在历史战绩的活动有哪些？</h5>
</div>
</div>
<div id="outline-container-org07b5043" class="outline-4">
<h4 id="org07b5043"><span class="section-number-4">1.1.4</span> 该主播在某个活动的排名？</h4>
</div>
<div id="outline-container-orgad2fb38" class="outline-4">
<h4 id="orgad2fb38"><span class="section-number-4">1.1.5</span> 是否要有分页</h4>
</div>
</div>
<div id="outline-container-org507b5c0" class="outline-3">
<h3 id="org507b5c0"><span class="section-number-3">1.2</span> H5 展示</h3>
<div class="outline-text-3" id="text-1-2">
</div>
<div id="outline-container-org2f0f80f" class="outline-4">
<h4 id="org2f0f80f"><span class="section-number-4">1.2.1</span> 即将开始的活动</h4>
<div class="outline-text-4" id="text-1-2-1">
</div>
<div id="outline-container-org7bf8749" class="outline-5">
<h5 id="org7bf8749"><span class="section-number-5">1.2.1.1</span> banner 图</h5>
</div>
<div id="outline-container-orgfb3c2c5" class="outline-5">
<h5 id="orgfb3c2c5"><span class="section-number-5">1.2.1.2</span> auto_register 字段</h5>
</div>
<div id="outline-container-org5bb1755" class="outline-5">
<h5 id="org5bb1755"><span class="section-number-5">1.2.1.3</span> 拼接活动起止时间字段：开始时间-结束时间</h5>
</div>
<div id="outline-container-org6cc4000" class="outline-5">
<h5 id="org6cc4000"><span class="section-number-5">1.2.1.4</span> 家族积分奖励是什么？该活动 top1 计算得到的本活动年度积分</h5>
</div>
</div>
<div id="outline-container-org5550018" class="outline-4">
<h4 id="org5550018"><span class="section-number-4">1.2.2</span> 活动系列一览</h4>
<div class="outline-text-4" id="text-1-2-2">
</div>
<div id="outline-container-orgcbf0246" class="outline-5">
<h5 id="orgcbf0246"><span class="section-number-5">1.2.2.1</span> 单个系列</h5>
<div class="outline-text-5" id="text-1-2-2-1">
</div>
<ol class="org-ol">
<li><a id="orga11d8cc"></a>活动按 end_time 排序<br></li>
<li><a id="orgf09a053"></a>顶部 top3 uesr 是该系列 top3<br></li>
<li><a id="org453b87b"></a>单个活动<br>
<ol class="org-ol">
<li><a id="orgf59d288"></a>正在进行中、已结束标志<br></li>
<li><a id="org8a4e65a"></a>家族积分奖励是什么？<br></li>
<li><a id="org6e750e4"></a>该活动 top3 user<br></li>
<li><a id="org09af82e"></a>可点击吗？<br></li>
</ol>
</li>
</ol>
</div>
<div id="outline-container-org5867e84" class="outline-5">
<h5 id="org5867e84"><span class="section-number-5">1.2.2.2</span> 展示哪些活动系列</h5>
</div>
<div id="outline-container-orgf679a7c" class="outline-5">
<h5 id="orgf679a7c"><span class="section-number-5">1.2.2.3</span> 系列排序</h5>
</div>
<div id="outline-container-org45ac8fc" class="outline-5">
<h5 id="org45ac8fc"><span class="section-number-5">1.2.2.4</span> 系列名称、背景图片</h5>
</div>
</div>

<div id="outline-container-org82a23c4" class="outline-4">
<h4 id="org82a23c4"><span class="section-number-4">1.2.3</span> H5 年度单个系列榜单</h4>
<div class="outline-text-4" id="text-1-2-3">
</div>
<div id="outline-container-org7a854fb" class="outline-5">
<h5 id="org7a854fb"><span class="section-number-5">1.2.3.1</span> 主播在该系列排名、积分、用户信息。建议不要加“尚未参加活动”</h5>
</div>
<div id="outline-container-org8f45d86" class="outline-5">
<h5 id="org8f45d86"><span class="section-number-5">1.2.3.2</span> 榜单</h5>
<div class="outline-text-5" id="text-1-2-3-2">
</div>
<ol class="org-ol">
<li><a id="org0c156c3"></a>是否需要传递 room_id<br></li>
<li><a id="orgc1e7f37"></a>排名、积分、用户信息、没有骑士榜<br></li>
<li><a id="org048cf9c"></a>分页<br></li>
</ol>
</div>
</div>
</div>
</div>

<div id="outline-container-org0629a17" class="outline-2">
<h2 id="org0629a17"><span class="section-number-2">2</span> 开发内容</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org0c5edf7" class="outline-3">
<h3 id="org0c5edf7"><span class="section-number-3">2.1</span> <span class="done DONE">DONE</span> 榜单</h3>
<div class="outline-text-3" id="text-2-1">
</div>
<div id="outline-container-org5effb15" class="outline-4">
<h4 id="org5effb15"><span class="section-number-4">2.1.1</span> 是否需要传递 room_id</h4>
</div>
<div id="outline-container-org9140e63" class="outline-4">
<h4 id="org9140e63"><span class="section-number-4">2.1.2</span> 要有分页</h4>
</div>
</div>
<div id="outline-container-org83c4409" class="outline-3">
<h3 id="org83c4409"><span class="section-number-3">2.2</span> <span class="todo DOING">DOING</span> h5 展示接口</h3>
<div class="outline-text-3" id="text-2-2">
</div>
<div id="outline-container-orgbebb8ce" class="outline-4">
<h4 id="orgbebb8ce"><span class="section-number-4">2.2.1</span> 分页如何做</h4>
</div>
</div>
<div id="outline-container-orgb5743c7" class="outline-3">
<h3 id="orgb5743c7"><span class="section-number-3">2.3</span> <span class="todo DOING">DOING</span> 年度积分接口</h3>
</div>
<div id="outline-container-org29d587a" class="outline-3">
<h3 id="org29d587a"><span class="section-number-3">2.4</span> <span class="done DONE">DONE</span> 2 个运营后台</h3>
</div>
<div id="outline-container-orgb38bfec" class="outline-3">
<h3 id="orgb38bfec"><span class="section-number-3">2.5</span> <span class="done DONE">DONE</span> 运营后台 2 个表的缓存，以及缓存更新</h3>
</div>
<div id="outline-container-orgcea5340" class="outline-3">
<h3 id="orgcea5340"><span class="section-number-3">2.6</span> <span class="todo DOING">DOING</span> 各种不同活动类型计算积分的算法，以及积分重算机制</h3>
<div class="outline-text-3" id="text-2-6">
<div class="org-src-container">
<pre class="src src-js">{
    <span style="color: #00afaf;">"rank_to_score"</span>: [10, 7, 5, 3, 2, 1],
    <span style="color: #00afaf;">"score_to_score"</span>: [10000, 1000, 2]
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org579717b" class="outline-3">
<h3 id="org579717b"><span class="section-number-3">2.7</span> <span class="done DONE">DONE</span> schedule 每个 1 小时刷一次正在进行的活动积分</h3>
</div>
<div id="outline-container-orga26e3a4" class="outline-3">
<h3 id="orga26e3a4"><span class="section-number-3">2.8</span> <span class="done DONE">DONE</span> 改造骑士榜</h3>
</div>
<div id="outline-container-org210b0ea" class="outline-3">
<h3 id="org210b0ea"><span class="section-number-3">2.9</span> <span class="todo DOING">DOING</span> 维护所有主播系列排名信息、系列得分；维护主播在所有活动的活动排名</h3>
</div>
</div>
<div id="outline-container-orgafbb62b" class="outline-2">
<h2 id="orgafbb62b"><span class="section-number-2">3</span> 上线注意事项 &amp;&amp; 注意事项</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org10b85e0" class="outline-3">
<h3 id="org10b85e0"><span class="section-number-3">3.1</span> 建表</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #5f8700;">CREATE</span> <span style="color: #5f8700;">TABLE</span> `series_to_event` (
  `id` <span style="color: #af8700;">int</span>(10) unsigned <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> AUTO_INCREMENT,
  `series` <span style="color: #af8700;">varchar</span>(40) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> COMMENT <span style="color: #00afaf;">'&#24180;&#24230;&#27036;&#21517;&#65292;&#31995;&#21015;&#27036;&#21517;'</span>,
  `event_name` <span style="color: #af8700;">varchar</span>(40) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> COMMENT <span style="color: #00afaf;">'name of event'</span>,
  `board` tinyint(4) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'0'</span>,
  `event_desc` <span style="color: #af8700;">varchar</span>(128) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> COMMENT <span style="color: #00afaf;">'&#29992;&#20110;&#23637;&#31034;&#30340;&#27963;&#21160;&#21517;'</span>,
  `sort` <span style="color: #af8700;">int</span>(10) unsigned <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'0'</span>,
  `is_enabled` tinyint(4) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'0'</span>,
  `rules` <span style="color: #af8700;">varchar</span>(4096) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'{}'</span>,
  `pt` <span style="color: #af8700;">int</span>(10) unsigned <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'0'</span>,
  `image` <span style="color: #af8700;">varchar</span>(1024) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">''</span>,
  `open_url` <span style="color: #af8700;">varchar</span>(1024) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">''</span> COMMENT <span style="color: #00afaf;">'&#35813;&#27963;&#21160;&#27036;&#21333; url'</span>,
  `topk` <span style="color: #af8700;">varchar</span>(256) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'[]'</span>,
  `ctime` datetime <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span>,
  `mtime` <span style="color: #af8700;">timestamp</span> <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #5f8700;">CURRENT_TIMESTAMP</span> <span style="color: #5f8700;">ON</span> <span style="color: #5f8700;">UPDATE</span> <span style="color: #5f8700;">CURRENT_TIMESTAMP</span>,
  <span style="color: #5f8700;">PRIMARY</span> <span style="color: #5f8700;">KEY</span> (`id`),
  <span style="color: #5f8700;">UNIQUE</span> <span style="color: #5f8700;">KEY</span> `uq_series_event_name_board` (`series`,`event_name`,`board`),
  <span style="color: #5f8700;">KEY</span> `idx_name` (`series`)
) ENGINE=InnoDB AUTO_INCREMENT=1 <span style="color: #5f8700;">DEFAULT</span> CHARSET=utf8mb4;

<span style="color: #5f8700;">CREATE</span> <span style="color: #5f8700;">TABLE</span> `series_settings` (
  `id` <span style="color: #af8700;">int</span>(10) unsigned <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> AUTO_INCREMENT,
  `series` <span style="color: #af8700;">varchar</span>(40) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> COMMENT <span style="color: #00afaf;">'&#24180;&#24230;&#27036;&#21517;&#65292;&#31995;&#21015;&#27036;&#21517;'</span>,
  `series_title` <span style="color: #af8700;">varchar</span>(128) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> "" COMMENT <span style="color: #00afaf;">'&#31995;&#21015;&#26631;&#39064;'</span>,
  `series_desc` <span style="color: #af8700;">varchar</span>(4096) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> "" COMMENT <span style="color: #00afaf;">'&#31995;&#21015;&#25551;&#36848;'</span>,
  `<span style="color: #5f8700;">type</span>` tinyint(4) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> COMMENT <span style="color: #00afaf;">'1-&#24180;&#24230; 2-&#31995;&#21015;'</span>,
  `series_url` <span style="color: #af8700;">varchar</span>(1024) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> "" COMMENT <span style="color: #00afaf;">'&#35813;&#31995;&#21015;&#30340;url'</span>,
  `sort` <span style="color: #af8700;">int</span>(10) unsigned <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'0'</span>,
  `is_enabled` tinyint(4) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'0'</span>,
  `topk` <span style="color: #af8700;">varchar</span>(256) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'[]'</span>,
  `ctime` datetime <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span>,
  `mtime` <span style="color: #af8700;">timestamp</span> <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #5f8700;">CURRENT_TIMESTAMP</span> <span style="color: #5f8700;">ON</span> <span style="color: #5f8700;">UPDATE</span> <span style="color: #5f8700;">CURRENT_TIMESTAMP</span>,
  <span style="color: #5f8700;">PRIMARY</span> <span style="color: #5f8700;">KEY</span> (`id`),
  <span style="color: #5f8700;">UNIQUE</span> <span style="color: #5f8700;">KEY</span> `uq_series` (`series`)
) ENGINE=InnoDB AUTO_INCREMENT=1 <span style="color: #5f8700;">DEFAULT</span> CHARSET=utf8mb4;
</pre>
</div>
</div>
</div>
<div id="outline-container-orge4b5ee8" class="outline-3">
<h3 id="orge4b5ee8"><span class="section-number-3">3.2</span> series_to_event rules 运营配置</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">
<pre class="src src-js">{
    <span style="color: #00afaf;">"rank_to_score"</span>: [10, 7, 5, 3, 2, 1],
    <span style="color: #00afaf;">"score_to_score"</span>: [10, 2, 1],
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org07f8938" class="outline-3">
<h3 id="org07f8938"><span class="section-number-3">3.3</span> 重新计算积分</h3>
<div class="outline-text-3" id="text-3-3">
</div>
<div id="outline-container-org98a8ca6" class="outline-4">
<h4 id="org98a8ca6"><span class="section-number-4">3.3.1</span> 吸金主播只获取了榜单前 200 名进行重新计算积分</h4>
</div>
<div id="outline-container-org59aaffd" class="outline-4">
<h4 id="org59aaffd"><span class="section-number-4">3.3.2</span> common_rank 只获取了榜单前 200 名进行重新计算积分</h4>
</div>
</div>
<div id="outline-container-orgf598d66" class="outline-3">
<h3 id="orgf598d66"><span class="section-number-3">3.4</span> rank_to_score 和 score_to_score 可同时生效</h3>
</div>
<div id="outline-container-org3d2ba37" class="outline-3">
<h3 id="org3d2ba37"><span class="section-number-3">3.5</span> 涉及服务</h3>
<div class="outline-text-3" id="text-3-5">
</div>
<div id="outline-container-org986328d" class="outline-4">
<h4 id="org986328d"><span class="section-number-4">3.5.1</span> http</h4>
</div>
<div id="outline-container-org6cc3ed1" class="outline-4">
<h4 id="org6cc3ed1"><span class="section-number-4">3.5.2</span> admin</h4>
</div>
<div id="outline-container-org689cd28" class="outline-4">
<h4 id="org689cd28"><span class="section-number-4">3.5.3</span> schedule-event</h4>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p>本笔记系统由
    <a href="">时中贺</a> 搭建和维护，使用
    <a href="https://www.gnu.org/software/emacs/">Emacs</a>
    <a href="http://orgmode.org/">Org mode</a> 编辑和构建
    <br />
    email: shi_zhonghe@163.com
</p>
<script src="file:/Users/he/notes/html/css/jquery-2.1.3.min.js"></script>
<script src="file:/Users/he/notes/html/css/main.js"></script>
</div>
</body>
</html>
