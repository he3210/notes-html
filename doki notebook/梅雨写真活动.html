<!DOCTYPE html>
<html lang="zh-CN">
<head>
<!-- 2021-05-06 Thu 15:26 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>&lrm;</title>
<meta name="generator" content="Org mode">
<meta name="author" content="时中贺">
<link rel="stylesheet" type="text/css" href="file:/Users/he/notes/html/css/style.css" />
<link rel="shortcut icon" href="file:/Users/he/notes/html/images/favicon.ico" type="image/x-icon" />
</head>
<body>
<div id="preamble" class="status">
<div id="navbar">
    <ul>
        <li id="site-master"><a href="file:/Users/he/notes/html/index.html">浪的不轻</a></li>
        <li><a class="navbar-item" href="file:/Users/he/notes/html/gallery.html">Gallery</a> </li>
        <li><a class="navbar-item" href="file:/Users/he/notes/html/notebooks.html">Notebooks</a> </li>
        <li><a class="navbar-item" href="file:/Users/he/notes/html/links.html">Links</a> </li>
        <li><a class="navbar-item" href="file:/Users/he/notes/html/about.html">About</a> </li>
        <li class="search">
            <form action="http://google.com/search" method="get" accept-charset="utf-8">
                <input type="search" id="search" name="q" autocomplete="off" maxlength="30" placeholder="Google..">
                <input type="hidden" name="q" value="site:www.langdebuqing.com">
            </form>
        </li>
    </ul>
</div>
</div>
<div id="content">
<div id="table-of-contents">
<h2>&#30446;&#24405;</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org5eeba0b">1. 问题</a>
<ul>
<li><a href="#org9cac1d8">1.1. 官方账号直接送礼物</a></li>
<li><a href="#org74e9ff7">1.2. 若连续获得头像框，则有效期时间累加，获得时立即生效，初始有效期为7天</a></li>
<li><a href="#org3196806">1.3. 双倍经验 + 双经验时间延长</a></li>
<li><a href="#orge8354a7">1.4. 超级礼盒是自动兑换还是用户自己兑换？</a></li>
<li><a href="#org33e5af3">1.5. 心动礼盒和超级礼盒中奖池轮播？</a></li>
<li><a href="#org321ae87">1.6. 粉丝兑换主播的写真，需要服务端做些什么？</a></li>
<li><a href="#org71d3910">1.7. 惊喜礼盒概率？</a></li>
<li><a href="#org1c2a248">1.8. 日榜粉丝top1会登上icon？日榜是哪个粉丝日榜，主播粉丝日榜 or 粉丝日榜</a></li>
<li><a href="#org2cb7432">1.9. icon 上pt，顺位是啥？</a></li>
</ul>
</li>
<li><a href="#org8d6fe51">2. 数据结构</a>
<ul>
<li><a href="#orge8ac56f">2.1. 主播任务完成度</a></li>
<li><a href="#org150a0e9">2.2. 礼盒抽奖</a></li>
<li><a href="#org407f529">2.3. icon</a></li>
<li><a href="#orgfd6547d">2.4. 剪刀手兑换</a></li>
<li><a href="#orgcfd8855">2.5. 中奖历史表</a></li>
<li><a href="#org02ed687">2.6. 卡片收集</a></li>
</ul>
</li>
<li><a href="#org38af431">3. 运营配置</a></li>
<li><a href="#org0e2bac5">4. 开发</a>
<ul>
<li><a href="#org5d337e3">4.1. 收礼模块</a></li>
<li><a href="#orgab028b7">4.2. 状态同步</a></li>
<li><a href="#orga6ac76d">4.3. http 接口</a></li>
</ul>
</li>
</ul>
</div>
</div>
<p>
+TITLE: 梅雨写真活动<br>
</p>
<div id="outline-container-org5eeba0b" class="outline-2">
<h2 id="org5eeba0b"><span class="section-number-2">1</span> 问题</h2>
<div class="outline-text-2" id="text-1">
</div>
<div id="outline-container-org9cac1d8" class="outline-3">
<h3 id="org9cac1d8"><span class="section-number-3">1.1</span> 官方账号直接送礼物</h3>
</div>
<div id="outline-container-org74e9ff7" class="outline-3">
<h3 id="org74e9ff7"><span class="section-number-3">1.2</span> 若连续获得头像框，则有效期时间累加，获得时立即生效，初始有效期为7天</h3>
</div>
<div id="outline-container-org3196806" class="outline-3">
<h3 id="org3196806"><span class="section-number-3">1.3</span> 双倍经验 + 双经验时间延长</h3>
</div>
<div id="outline-container-orge8354a7" class="outline-3">
<h3 id="orge8354a7"><span class="section-number-3">1.4</span> 超级礼盒是自动兑换还是用户自己兑换？</h3>
</div>
<div id="outline-container-org33e5af3" class="outline-3">
<h3 id="org33e5af3"><span class="section-number-3">1.5</span> 心动礼盒和超级礼盒中奖池轮播？</h3>
</div>
<div id="outline-container-org321ae87" class="outline-3">
<h3 id="org321ae87"><span class="section-number-3">1.6</span> 粉丝兑换主播的写真，需要服务端做些什么？</h3>
</div>
<div id="outline-container-org71d3910" class="outline-3">
<h3 id="org71d3910"><span class="section-number-3">1.7</span> 惊喜礼盒概率？</h3>
</div>
<div id="outline-container-org1c2a248" class="outline-3">
<h3 id="org1c2a248"><span class="section-number-3">1.8</span> 日榜粉丝top1会登上icon？日榜是哪个粉丝日榜，主播粉丝日榜 or 粉丝日榜</h3>
</div>
<div id="outline-container-org2cb7432" class="outline-3">
<h3 id="org2cb7432"><span class="section-number-3">1.9</span> icon 上pt，顺位是啥？</h3>
</div>
</div>
<div id="outline-container-org8d6fe51" class="outline-2">
<h2 id="org8d6fe51"><span class="section-number-2">2</span> 数据结构</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-orge8ac56f" class="outline-3">
<h3 id="orge8ac56f"><span class="section-number-3">2.1</span> 主播任务完成度</h3>
<div class="outline-text-3" id="text-2-1">
<p>
redis hash key              field       value<br>
pre + event_name + uid    task_id    progress_value<br>
</p>

<p>
每日门槛任务 task_id 格式为 "daily_task:%s" % date_str。progress_value 为礼物 score<br>
礼盒任务 task_id 格式为 "normal_task:%s" % str(gift_id)。progress_value 为收礼数量<br>
开盒机会 "normal:exchange" 主播已打开普通礼盒次数<br>
卡片收集 "card:0" 代表卡片0<br>
         "card_task:exchange" 用户打开超级礼盒总次数<br>
</p>
<div class="org-src-container">
<pre class="src src-js">{
    <span style="color: #00afaf;">"daily_task:20200605"</span>: 200,
    <span style="color: #00afaf;">"daily_task:20200605"</span>: 300,
    <span style="color: #00afaf;">"normal_task:265"</span>: 3,
    <span style="color: #00afaf;">"normal_task:275"</span>: 4,
    <span style="color: #00afaf;">"normal_chance:exchange"</span>: 3,
    <span style="color: #00afaf;">"card:0"</span>: 3,
    <span style="color: #00afaf;">"card:1"</span>: 2,
    <span style="color: #00afaf;">"card_task:exchange"</span>: 1
}
</pre>
</div>
</div>
</div>

<div id="outline-container-org150a0e9" class="outline-3">
<h3 id="org150a0e9"><span class="section-number-3">2.2</span> 礼盒抽奖</h3>
<div class="outline-text-3" id="text-2-2">
<p>
redis hash key            field    value<br>
pre + event_name + uid    index   awards_json<br>
</p>

<div class="org-src-container">
<pre class="src src-js">
</pre>
</div>
</div>
</div>
<div id="outline-container-org407f529" class="outline-3">
<h3 id="org407f529"><span class="section-number-3">2.3</span> icon</h3>
<div class="outline-text-3" id="text-2-3">
<div class="org-src-container">
<pre class="src src-js">{
    <span style="color: #00afaf;">"anchor"</span>: {},
    <span style="color: #00afaf;">"knight"</span>: {},
    <span style="color: #00afaf;">"normal_chance"</span>: 4,
    <span style="color: #00afaf;">"super_chance"</span>: 1,
    <span style="color: #00afaf;">"cur_stage"</span>: <span style="color: #00afaf;">"daily_task"</span>,
    <span style="color: #00afaf;">"daily_task"</span>: {
        <span style="color: #00afaf;">"task_name"</span>: <span style="color: #00afaf;">"&#26228;&#22825;&#23043;&#23043;"</span>,
        <span style="color: #00afaf;">"cur_score"</span>: 200,
        <span style="color: #00afaf;">"all_score"</span>: 300
    },
    <span style="color: #00afaf;">"normal_task"</span>: [
        {
            <span style="color: #00afaf;">"gift_id"</span>: 275,
            <span style="color: #00afaf;">"img"</span>: <span style="color: #00afaf;">"xxx"</span>,
            <span style="color: #00afaf;">"task_name"</span>: <span style="color: #00afaf;">"&#32043;&#38451;&#33457;"</span>,
            <span style="color: #00afaf;">"cur_score"</span>: 10,
            <span style="color: #00afaf;">"all_score"</span>: 30,
            <span style="color: #00afaf;">"received_chance"</span>: 3
        }
    ]
}
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfd6547d" class="outline-3">
<h3 id="orgfd6547d"><span class="section-number-3">2.4</span> 剪刀手兑换</h3>
<div class="outline-text-3" id="text-2-4">
<div class="org-src-container">
<pre class="src src-js">{
    <span style="color: #00afaf;">"coin:0"</span>: 3,
    <span style="color: #00afaf;">"coin:1"</span>: 2,
    <span style="color: #00afaf;">"coin:2"</span>: 4,
    <span style="color: #00afaf;">"reward_exchanged:0"</span>: 3,
    <span style="color: #00afaf;">"reward_exchanged:1"</span>: 2,
    <span style="color: #00afaf;">"reward_exchanged:2"</span>: 4
}
</pre>
</div>
</div>
</div>
<div id="outline-container-orgcfd8855" class="outline-3">
<h3 id="orgcfd8855"><span class="section-number-3">2.5</span> 中奖历史表</h3>
<div class="outline-text-3" id="text-2-5">
<div class="org-src-container">
<pre class="src src-sql"><span style="color: #5f8700;">CREATE</span> <span style="color: #5f8700;">TABLE</span> `flower_box_award_history` (
`id` <span style="color: #af8700;">int</span>(10) unsigned <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> AUTO_INCREMENT,
`event_name` <span style="color: #af8700;">varchar</span>(64) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span>,
`uid` <span style="color: #af8700;">varchar</span>(32) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> COMMENT <span style="color: #00afaf;">'anchor uid'</span>,
`box_name` <span style="color: #af8700;">varchar</span>(64) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> COMMENT <span style="color: #00afaf;">'&#20174;&#21738;&#20010;&#30418;&#23376;&#24320;&#20986;&#30340;&#31036;&#29289;'</span>,
`box_img` <span style="color: #af8700;">varchar</span>(128) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span>,
`content` <span style="color: #af8700;">varchar</span>(128) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> COMMENT <span style="color: #00afaf;">'&#24320;&#20986;&#30340;&#20869;&#23481;'</span>,
`is_enabled` tinyint(4) <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #00afaf;">'1'</span>,
`ctime` datetime <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span>,
`mtime` <span style="color: #af8700;">timestamp</span> <span style="color: #5f8700;">NOT</span> <span style="color: #5f8700;">NULL</span> <span style="color: #5f8700;">DEFAULT</span> <span style="color: #5f8700;">CURRENT_TIMESTAMP</span> <span style="color: #5f8700;">ON</span> <span style="color: #5f8700;">UPDATE</span> <span style="color: #5f8700;">CURRENT_TIMESTAMP</span>,
<span style="color: #5f8700;">PRIMARY</span> <span style="color: #5f8700;">KEY</span> (`id`),
<span style="color: #5f8700;">KEY</span> `idx_event_name_uid` (`event_name`, `uid`)
) ENGINE = InnoDB AUTO_INCREMENT = 1 <span style="color: #5f8700;">DEFAULT</span> CHARSET = utf8mb4;
</pre>
</div>
</div>
</div>

<div id="outline-container-org02ed687" class="outline-3">
<h3 id="org02ed687"><span class="section-number-3">2.6</span> 卡片收集</h3>
<div class="outline-text-3" id="text-2-6">
<p>
不再基于背包物品实现<br>
</p>
</div>
</div>
</div>

<div id="outline-container-org38af431" class="outline-2">
<h2 id="org38af431"><span class="section-number-2">3</span> 运营配置</h2>
<div class="outline-text-2" id="text-3">
<div class="org-src-container">
<pre class="src src-js">{
    <span style="color: #00afaf;">"icon_knight_score_limit"</span>: [5000, 10000, 15000]
}
</pre>
</div>
</div>
</div>
<div id="outline-container-org0e2bac5" class="outline-2">
<h2 id="org0e2bac5"><span class="section-number-2">4</span> 开发</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org5d337e3" class="outline-3">
<h3 id="org5d337e3"><span class="section-number-3">4.1</span> 收礼模块</h3>
</div>
<div id="outline-container-orgab028b7" class="outline-3">
<h3 id="orgab028b7"><span class="section-number-3">4.2</span> 状态同步</h3>
</div>
<div id="outline-container-orga6ac76d" class="outline-3">
<h3 id="orga6ac76d"><span class="section-number-3">4.3</span> http 接口</h3>
<div class="outline-text-3" id="text-4-3">
<ul class="org-ul">
<li>全平台主播心动礼盒/超级礼盒中奖历史？<br></li>
<li>任务完成度接口<br></li>
<li><b><b>拆心动礼盒接口</b></b><br></li>
<li><b><b>拆超级礼盒接口</b></b><br></li>
<li>主播开盒记录，50条<br></li>
<li>我的剪刀手相关接口<br></li>
</ul>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p>本笔记系统由
    <a href="">时中贺</a> 搭建和维护，使用
    <a href="https://www.gnu.org/software/emacs/">Emacs</a>
    <a href="http://orgmode.org/">Org mode</a> 编辑和构建
    <br />
    email: shi_zhonghe@163.com
</p>
<script src="file:/Users/he/notes/html/css/jquery-2.1.3.min.js"></script>
<script src="file:/Users/he/notes/html/css/main.js"></script>
</div>
</body>
</html>
